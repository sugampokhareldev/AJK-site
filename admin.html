<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="csrf-token" content="">

    <title>AJK Cleaning - Modern Admin Panel</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>

        :root {

            /* Modern Color Palette */

            --primary: #6366f1;

            --primary-light: #818cf8;

            --primary-dark: #4f46e5;

            --secondary: #8b5cf6;

            --accent: #06b6d4;

            --success: #10b981;

            --warning: #f59e0b;

            --danger: #ef4444;

            

            /* Neutral Colors */

            --gray-50: #f8fafc;

            --gray-100: #f1f5f9;

            --gray-200: #e2e8f0;

            --gray-300: #cbd5e1;

            --gray-400: #94a3b8;

            --gray-500: #64748b;

            --gray-600: #475569;

            --gray-700: #334155;

            --gray-800: #1e293b;

            --gray-900: #0f172a;

            

            /* Background & Surface */

            --bg-primary: #ffffff;

            --bg-secondary: #f8fafc;

            --bg-tertiary: #f1f5f9;

            --surface: #ffffff;

            --surface-hover: #f8fafc;

            

            /* Shadows & Effects */

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);

            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);

            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);

            

            /* Modern Gradients */

            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            --gradient-success: linear-gradient(135deg, #667eea 0%, #10b981 100%);

            --gradient-card: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.95) 100%);

            

            /* Border Radius */

            --radius-sm: 6px;

            --radius: 12px;

            --radius-lg: 16px;

            --radius-xl: 24px;

            

            /* Transitions */

            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

            --transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

        }



        /* Dark Mode Variables */

        [data-theme="dark"] {

            --bg-primary: #0f172a;

            --bg-secondary: #1e293b;

            --bg-tertiary: #334155;

            --surface: #1e293b;

            --surface-hover: #334155;

            --gray-50: #334155;

            --gray-100: #475569;

            --gray-200: #64748b;

            --gray-700: #cbd5e1;

            --gray-800: #e2e8f0;

            --gray-900: #f1f5f9;

        }



        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }



        html {

            -webkit-text-size-adjust: 100%; /* Prevent font scaling in landscape */

        }



        body {

            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

            background: var(--bg-secondary);

            color: var(--gray-800);

            line-height: 1.6;

            font-size: 14px;

            overflow-x: hidden;

            /* Prevent elastic scrolling on iOS */

            position: fixed;

            width: 100%;

            height: 100%;

            overflow: hidden;

        }



        /* Enhanced Mobile Styles */

        body.mobile-device {

            --header-height: 56px;

            --nav-width: 85%;

        }



        /* Glassmorphism Login */

        .login-container {

            min-height: 100vh;

            display: flex;

            align-items: center;

            justify-content: center;

            background: var(--gradient-primary);

            position: relative;

            overflow: hidden;

            padding: 16px;

        }



        .login-container::before {

            content: '';

            position: absolute;

            top: -50%;

            left: -50%;

            width: 200%;

            height: 200%;

            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);

            background-size: 30px 30px;

            animation: float 20s infinite linear;

            pointer-events: none;

        }



        @keyframes float {

            0% { transform: translate(0, 0) rotate(0deg); }

            100% { transform: translate(-30px, -30px) rotate(360deg); }

        }



        .login-form {

            background: rgba(255, 255, 255, 0.95);

            backdrop-filter: blur(20px);

            padding: 32px 24px;

            border-radius: var(--radius-xl);

            box-shadow: var(--shadow-2xl);

            width: 100%;

            max-width: 420px;

            border: 1px solid rgba(255, 255, 255, 0.2);

            position: relative;

            z-index: 1;

            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);

        }



        @keyframes slideUp {

            from { 

                opacity: 0;

                transform: translateY(30px) scale(0.95);

            }

            to { 

                opacity: 1;

                transform: translateY(0) scale(1);

            }

        }



        .login-form h2 {

            text-align: center;

            margin-bottom: 24px;

            color: var(--gray-900);

            font-weight: 800;

            font-size: 24px;

            background: var(--gradient-primary);

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

        }



        .login-logo {

            width: 56px;

            height: 56px;

            background: var(--gradient-primary);

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            margin: 0 auto 20px;

            box-shadow: var(--shadow-lg);

        }



        .login-logo i {

            font-size: 24px;

            color: white;

        }



        .form-group {

            margin-bottom: 20px;

            position: relative;

        }



        .form-group label {

            display: block;

            margin-bottom: 8px;

            font-weight: 600;

            color: var(--gray-700);

            font-size: 14px;

        }



        .input-group {

            position: relative;

        }



        .input-group input {

            width: 100%;

            padding: 16px 20px 16px 48px;

            border: 2px solid var(--gray-200);

            border-radius: var(--radius);

            font-size: 16px;

            transition: var(--transition);

            background: var(--bg-primary);

            color: var(--gray-800);

            -webkit-appearance: none; /* Remove iOS styling */

        }



        .input-group i {

            position: absolute;

            left: 16px;

            top: 50%;

            transform: translateY(-50%);

            color: var(--gray-400);

            transition: var(--transition);

        }



        .input-group input:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);

        }



        .input-group input:focus + i {

            color: var(--primary);

        }



        .login-btn {

            width: 100%;

            padding: 16px;

            background: var(--gradient-primary);

            color: white;

            border: none;

            border-radius: var(--radius);

            font-size: 16px;

            font-weight: 600;

            cursor: pointer;

            transition: var(--transition);

            box-shadow: var(--shadow-md);

            position: relative;

            overflow: hidden;

            min-height: 52px; /* Ensure touch target is large enough */

        }



        .login-btn:hover {

            transform: translateY(-2px);

            box-shadow: var(--shadow-lg);

        }



        .login-btn::before {

            content: '';

            position: absolute;

            top: 0;

            left: -100%;

            width: 100%;

            height: 100%;

            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);

            transition: left 0.5s;

        }



        .login-btn:hover::before {

            left: 100%;

        }



        /* Modern Admin Layout */

        .admin-panel {

            display: none;

            min-height: 100vh;

            background: var(--bg-secondary);

        }



        .admin-header {

            background: var(--surface);

            border-bottom: 1px solid var(--gray-200);

            padding: 0 16px;

            height: 60px;

            display: flex;

            align-items: center;

            justify-content: space-between;

            position: sticky;

            top: 0;

            z-index: 100;

            backdrop-filter: blur(20px);

            box-shadow: var(--shadow-sm);

        }



        .header-left {

            display: flex;

            align-items: center;

            gap: 12px;

        }



        .logo-section {

            display: flex;

            align-items: center;

            gap: 8px;

        }



        .logo-icon {

            width: 36px;

            height: 36px;

            background: var(--gradient-primary);

            border-radius: var(--radius);

            display: flex;

            align-items: center;

            justify-content: center;

            color: white;

            font-size: 16px;

            box-shadow: var(--shadow-md);

        }



        .logo-text {

            font-size: 18px;

            font-weight: 800;

            color: var(--gray-900);

        }



        .breadcrumb {

            display: none; /* Hide breadcrumb on mobile */

        }



        .header-right {

            display: flex;

            align-items: center;

            gap: 12px;

        }



        .theme-toggle {

            width: 40px;

            height: 40px;

            border: none;

            background: var(--bg-secondary);

            border-radius: var(--radius);

            color: var(--gray-600);

            cursor: pointer;

            transition: var(--transition);

            display: flex;

            align-items: center;

            justify-content: center;

        }



        .theme-toggle:hover {

            background: var(--gray-200);

            color: var(--primary);

        }



        .notification-badge {

            position: relative;

        }



        .notification-badge::after {

            content: '';

            position: absolute;

            top: 8px;

            right: 8px;

            width: 8px;

            height: 8px;

            background: var(--danger);

            border-radius: 50%;

            border: 2px solid var(--surface);

        }



        .user-menu {

            position: relative;

        }

        

        .user-menu-button {

            display: flex;

            align-items: center;

            gap: 8px;

            padding: 6px 10px;

            background: var(--bg-secondary);

            border-radius: var(--radius-lg);

            cursor: pointer;

            transition: var(--transition);

            border: none;

            min-height: 44px; /* Minimum touch target */

        }



        .user-menu-button:hover {

            background: var(--gray-200);

        }



        .user-avatar {

            width: 32px;

            height: 32px;

            background: var(--gradient-primary);

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            color: white;

            font-size: 14px;

            font-weight: 600;

        }



        .user-info {

            display: none; /* Hide user info on mobile */

        }



        .user-name {

            font-weight: 600;

            font-size: 14px;

            color: var(--gray-800);

        }



        .user-role {

            font-size: 12px;

            color: var(--gray-600);

        }



        .dropdown-menu {

            display: none;

            position: absolute;

            top: 110%;

            right: 0;

            background: var(--surface);

            border-radius: var(--radius);

            box-shadow: var(--shadow-lg);

            border: 1px solid var(--gray-200);

            width: 200px;

            z-index: 110;

            overflow: hidden;

            animation: fadeIn 0.2s ease-out;

        }

        

        .dropdown-menu.show {

            display: block;

        }

        

        .dropdown-item {

            display: flex;

            align-items: center;

            gap: 12px;

            padding: 12px 16px;

            color: var(--gray-700);

            text-decoration: none;

            transition: var(--transition);

            cursor: pointer;

            background: none;

            border: none;

            width: 100%;

            text-align: left;

            min-height: 44px; /* Minimum touch target */

        }



        .dropdown-item:hover {

            background: var(--bg-secondary);

            color: var(--primary);

        }

        

        .dropdown-divider {

            height: 1px;

            background: var(--gray-200);

            margin: 8px 0;

        }



        /* Sidebar Navigation */

        .admin-nav {

            position: fixed;

            left: -100%;

            top: 60px;

            width: 280px;

            height: calc(100vh - 60px);

            background: var(--surface);

            border-right: 1px solid var(--gray-200);

            padding: 24px 0;

            overflow-y: auto;

            z-index: 90;

            transition: var(--transition-slow);

            box-shadow: var(--shadow-xl);

        }



        .admin-nav.open {

            left: 0;

        }



        .nav-section {

            margin-bottom: 24px;

        }



        .nav-title {

            padding: 0 20px;

            font-size: 12px;

            font-weight: 700;

            color: var(--gray-500);

            text-transform: uppercase;

            letter-spacing: 0.5px;

            margin-bottom: 12px;

        }



        .nav-item {

            display: flex;

            align-items: center;

            gap: 16px;

            padding: 14px 20px;

            color: var(--gray-700);

            text-decoration: none;

            font-weight: 500;

            transition: var(--transition);

            position: relative;

            border: none;

            background: none;

            width: 100%;

            text-align: left;

            cursor: pointer;

            min-height: 48px; /* Minimum touch target */

        }



        .nav-item:hover {

            background: var(--bg-secondary);

            color: var(--primary);

        }



        .nav-item.active {

            background: rgba(99, 102, 241, 0.1);

            color: var(--primary);

            font-weight: 600;

        }



        .nav-item.active::after {

            content: '';

            position: absolute;

            right: 0;

            top: 0;

            bottom: 0;

            width: 3px;

            background: var(--primary);

        }



        .nav-item i {

            width: 20px;

            text-align: center;

            font-size: 16px;

        }



        /* Main Content Area */

        .main-content {

            margin-left: 0;

            padding: 16px;

            min-height: calc(100vh - 60px);

            transition: var(--transition);

            overflow-y: auto;

            height: calc(100vh - 60px);

        }



        /* Modern Cards */

        .card {

            background: var(--surface);

            border-radius: var(--radius-lg);

            box-shadow: var(--shadow-sm);

            border: 1px solid var(--gray-200);

            transition: var(--transition);

            overflow: hidden;

        }



        .card:hover {

            box-shadow: var(--shadow-md);

            transform: translateY(-2px);

        }



        .card-header {

            padding: 20px;

            border-bottom: 1px solid var(--gray-200);

            display: flex;

            align-items: center;

            justify-content: space-between;

        }



        .card-title {

            font-size: 18px;

            font-weight: 700;

            color: var(--gray-900);

            display: flex;

            align-items: center;

            gap: 12px;

        }



        .card-body {

            padding: 20px;

        }



        /* Stats Grid */

        .stats-grid {

            display: grid;

            grid-template-columns: 1fr;

            gap: 16px;

            margin-bottom: 24px;

        }



        .stat-card {

            background: var(--surface);

            padding: 20px;

            border-radius: var(--radius-lg);

            box-shadow: var(--shadow-sm);

            border: 1px solid var(--gray-200);

            position: relative;

            overflow: hidden;

            transition: var(--transition);

        }



        .stat-card::before {

            content: '';

            position: absolute;

            top: 0;

            left: 0;

            right: 0;

            height: 4px;

            background: linear-gradient(90deg, var(--primary), var(--accent));

        }



        .stat-card:hover {

            transform: translateY(-4px);

            box-shadow: var(--shadow-lg);

        }



        .stat-header {

            display: flex;

            align-items: center;

            justify-content: space-between;

            margin-bottom: 12px;

        }



        .stat-title {

            font-size: 14px;

            font-weight: 600;

            color: var(--gray-600);

            text-transform: uppercase;

            letter-spacing: 0.5px;

        }



        .stat-icon {

            width: 44px;

            height: 44px;

            border-radius: var(--radius);

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 20px;

            color: white;

        }



        .stat-icon.primary { background: var(--gradient-primary); }

        .stat-icon.success { background: linear-gradient(135deg, #10b981, #059669); }

        .stat-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }

        .stat-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }



        .stat-value {

            font-size: 28px;

            font-weight: 800;

            color: var(--gray-900);

            margin-bottom: 8px;

            line-height: 1;

        }



        .stat-trend {

            display: flex;

            align-items: center;

            gap: 6px;

            font-size: 14px;

            font-weight: 500;

        }



        .stat-trend.positive {

            color: var(--success);

        }



        .stat-trend.negative {

            color: var(--danger);

        }



        /* Modern Buttons */

        .btn {

            display: inline-flex;

            align-items: center;

            gap: 8px;

            padding: 12px 16px;

            border: none;

            border-radius: var(--radius);

            font-size: 14px;

            font-weight: 600;

            cursor: pointer;

            transition: var(--transition);

            text-decoration: none;

            position: relative;

            overflow: hidden;

            min-height: 44px; /* Minimum touch target */

        }



        .btn-primary {

            background: var(--gradient-primary);

            color: white;

            box-shadow: var(--shadow-sm);

        }



        .btn-primary:hover {

            transform: translateY(-2px);

            box-shadow: var(--shadow-md);

        }



        .btn-secondary {

            background: var(--gray-100);

            color: var(--gray-700);

        }



        .btn-secondary:hover {

            background: var(--gray-200);

        }



        .btn-success {

            background: linear-gradient(135deg, #10b981, #059669);

            color: white;

        }



        .btn-warning {

            background: linear-gradient(135deg, #f59e0b, #d97706);

            color: white;

        }



        .btn-danger {

            background: linear-gradient(135deg, #ef4444, #dc2626);

            color: white;

        }



        .btn-sm {

            padding: 10px 14px;

            font-size: 13px;

            min-height: 40px;

        }



        .btn-lg {

            padding: 16px 20px;

            font-size: 16px;

            min-height: 52px;

        }



        /* Modern Form Controls */

        .form-control {

            width: 100%;

            padding: 14px 16px;

            border: 2px solid var(--gray-200);

            border-radius: var(--radius);

            font-size: 16px; /* Prevent zoom on iOS */

            transition: var(--transition);

            background: var(--surface);

            color: var(--gray-800);

            -webkit-appearance: none;

        }



        .form-control:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);

        }



        .search-box {

            position: relative;

            width: 100%;

        }



        .search-box input {

            padding-left: 48px;

        }



        .search-box i {

            position: absolute;

            left: 16px;

            top: 50%;

            transform: translateY(-50%);

            color: var(--gray-400);

        }



        /* Modern Table */

        .table-container {

            background: var(--surface);

            border-radius: var(--radius-lg);

            overflow: hidden;

            box-shadow: var(--shadow-sm);

            border: 1px solid var(--gray-200);

            overflow-x: auto;

            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */

        }



        .table {

            width: 100%;

            border-collapse: collapse;

            min-width: 600px; /* Ensure table doesn't get too narrow */

        }



        .table thead {

            background: var(--bg-secondary);

        }



        .table th {

            padding: 14px 12px;

            text-align: left;

            font-weight: 600;

            color: var(--gray-700);

            font-size: 13px;

            text-transform: uppercase;

            letter-spacing: 0.5px;

            border-bottom: 1px solid var(--gray-200);

        }



        .table td {

            padding: 14px 12px;

            border-bottom: 1px solid var(--gray-200);

            color: var(--gray-800);

        }



        .table tbody tr:hover {

            background: var(--bg-secondary);

        }

        

        /* Charts */

        .chart-container {

            position: relative;

            height: 250px;

            padding: 16px;

        }



        /* Responsive Design */

        @media (min-width: 768px) {

            .admin-header {

                padding: 0 24px;

                height: 72px;

            }

            

            .admin-nav {

                top: 72px;

                height: calc(100vh - 72px);

            }

            

            .main-content {

                padding: 24px;

                height: calc(100vh - 72px);

            }

            

            .stats-grid {

                grid-template-columns: repeat(2, 1fr);

                gap: 20px;

            }

            

            .user-info {

                display: flex;

                flex-direction: column;

            }

            

            .breadcrumb {

                display: flex;

                align-items: center;

                gap: 8px;

                color: var(--gray-600);

                font-size: 14px;

            }

        }



        @media (min-width: 1024px) {

            .admin-nav {

                left: 0;

                transform: none;

                box-shadow: none;

            }

            

            .main-content {

                margin-left: 280px;

            }

            

            .stats-grid {

                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));

            }

            

            .mobile-menu-toggle {

                display: none;

            }

        }

        

        /* ENHANCED MOBILE & RESPONSIVE FIXES */

        @media (max-width: 767px) {

            body.mobile-device {

                --header-height: 56px;

            }

            

            .admin-header {

                height: 56px;

                padding: 0 12px;

            }

            

            .logo-text {

                font-size: 16px;

            }

            

            .main-content {

                padding: 12px;

            }



            .admin-header {

                padding: 0 12px;

            }

            

            .breadcrumb, .user-info {

                display: none;

            }



            .stats-grid {

                grid-template-columns: 1fr;

                gap: 12px;

            }

            

            .stat-card, .card {

                margin-bottom: 12px;

                padding: 16px;

            }

            

            #analytics-tab .stats-grid,

            #analytics-tab .grid-cols-2 {

                grid-template-columns: 1fr;

            }



            .login-form {

                margin: 0;

                padding: 20px 16px;

            }

            

            .table-controls, .auto-refresh-controls {

                flex-direction: column;

                align-items: stretch;

                gap: 12px;

            }



            .filter-controls {

                flex-direction: column;

                align-items: stretch;

            }

            

            /* Enhanced Responsive Table: Card View on Mobile */

            #submissionsTable thead {

                display: none;

            }



            #submissionsTable, #submissionsTable tbody, #submissionsTable tr, #submissionsTable td {

                display: block;

                width: 100%;

            }



            #submissionsTable tr {

                margin-bottom: 16px;

                border: 1px solid var(--gray-200);

                border-radius: var(--radius);

                overflow: hidden;

                box-shadow: var(--shadow-sm);

                background: var(--surface);

            }



            #submissionsTable td {

               padding: 0;

               border: none;

            }

            

            .pagination {

                flex-wrap: wrap;

            }

            

            /* Auto-refresh controls */

            .auto-refresh-controls {

                padding: 12px;

            }

            

            .auto-refresh-controls label {

                font-size: 14px;

            }

            

            .session-info {

                padding: 12px;

                font-size: 12px;

            }

            

            /* Table controls */

            .table-controls {

                padding: 12px;

            }

            

            .search-input {

                min-width: 100%;

            }

            

            .filter-controls {

                width: 100%;

            }

            

            .filter-select {

                min-width: 100%;

                margin-bottom: 8px;

            }

            

            .date-range-filter {

                flex-direction: column;

                width: 100%;

            }

            

            .date-input {

                width: 100%;

                margin-bottom: 8px;

            }

            

            /* Chat management */

            .chat-management h2 {

                font-size: 20px;

            }

            

            .search-controls {

                flex-direction: column;

            }

            

            .search-controls input,

            .search-controls select {

                min-width: 100%;

            }

            

            .chats-list {

                grid-template-columns: 1fr;

            }

            

            /* Modal adjustments */

            .chat-ticket-content {

                width: 100%;

                height: 100vh;

                margin: 0;

                padding: 16px;

                border-radius: 0;

            }

            

            .chat-ticket-header {

                flex-direction: column;

                align-items: flex-start;

                gap: 12px;

            }

            

            .client-actions {

                width: 100%;

                display: flex;

                gap: 8px;

            }

            

            .client-actions .btn {

                flex: 1;

                font-size: 13px;

                padding: 10px 12px;

            }

            

            .chat-ticket-messages {

                padding: 16px;

            }

            

            .message {

                max-width: 95%;

            }

            

            .message-avatar {

                width: 36px;

                height: 36px;

                font-size: 16px;

            }

            

            .message-bubble {

                padding: 12px 16px;

            }

            

            .chat-ticket-reply {

                flex-direction: column;

                gap: 12px;

            }

            

            #ticket-reply-input {

                min-height: 80px;

            }

            

            .chat-ticket-actions {

                flex-direction: column;

            }

            

            /* Settings */

            .settings-container {

                max-width: 100%;

            }

            

            .settings-card {

                padding: 16px;

            }

            

            .setting-item {

                flex-direction: column;

                align-items: flex-start;

                gap: 12px;

            }

            

            .setting-info h4 {

                font-size: 16px;

            }

            

            .setting-info p {

                font-size: 14px;

            }

            

            /* Pagination */

            .pagination {

                padding: 16px;

                flex-direction: column;

                gap: 12px;

            }

            

            .pagination button {

                width: 100%;

            }

            

            .pagination select {

                width: 100%;

            }

            

            /* Submission details */

            .submission-details {

                padding: 16px;

            }

            

            .detail-row {

                flex-direction: column;

            }

            

            .detail-label {

                width: 100%;

                margin-bottom: 4px;

            }

            

            /* Notification positioning */

            .notification-container {

                right: 16px;

                top: 70px;

            }

            

            .notification {

                width: 300px;

            }

            

            /* FAB positioning */

            .fab {

                bottom: 20px;

                right: 20px;

            }

            

            /* Enhanced mobile navigation */

            .admin-nav {

                width: 85%;

                max-width: 300px;

            }

            

            /* Improved touch targets */

            .btn, .nav-item, .action-btn, .dropdown-item {

                min-height: 44px;

            }

            

            /* Prevent zoom on inputs */

            input, select, textarea {

                font-size: 16px;

            }

        }



        /* Modern Animations */

        .fade-in {

            animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);

        }



        @keyframes fadeIn {

            from { opacity: 0; transform: translateY(20px); }

            to { opacity: 1; transform: translateY(0); }

        }



        .slide-up {

            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);

        }



        /* Loading States */

        .loading {

            display: inline-flex;

            align-items: center;

            gap: 8px;

            color: var(--gray-600);

        }



        .spinner {

            width: 16px;

            height: 16px;

            border: 2px solid var(--gray-300);

            border-top: 2px solid var(--primary);

            border-radius: 50%;

            animation: spin 1s linear infinite;

        }



        @keyframes spin {

            to { transform: rotate(360deg); }

        }



        /* Tab Content */

        .tab-content {

            display: none;

        }



        .tab-content.active {

            display: block;

            animation: fadeIn 0.3s ease;

        }



        /* Status Badges */

        .badge {

            display: inline-flex;

            align-items: center;

            padding: 6px 12px;

            border-radius: 20px;

            font-size: 12px;

            font-weight: 600;

        }



        .badge-success {

            background: rgba(16, 185, 129, 0.1);

            color: var(--success);

        }



        .badge-warning {

            background: rgba(245, 158, 11, 0.1);

            color: var(--warning);

        }



        .badge-danger {

            background: rgba(239, 68, 68, 0.1);

            color: var(--danger);

        }



        .badge-primary {

            background: rgba(99, 102, 241, 0.1);

            color: var(--primary);

        }



        /* NEW Notification Styling */

        .notification-container {

            position: fixed;

            top: 80px;

            right: 24px;

            z-index: 2000;

            display: flex;

            flex-direction: column;

            gap: 12px;

        }



        .notification {

            display: flex;

            align-items: center;

            gap: 12px;

            padding: 16px;

            background: var(--surface);

            border-radius: var(--radius);

            box-shadow: var(--shadow-lg);

            border-left: 4px solid var(--primary);

            width: 320px;

            transform: translateX(120%);

            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);

        }



        .notification.show {

            transform: translateX(0);

        }



        .notification-icon {

            font-size: 20px;

        }



        .notification-content {

            flex-grow: 1;

        }



        .notification-close {

            background: none;

            border: none;

            color: var(--gray-400);

            cursor: pointer;

            font-size: 16px;

        }

        .notification-close:hover {

            color: var(--gray-600);

        }



        .notification.success { border-left-color: var(--success); }

        .notification.success .notification-icon { color: var(--success); }



        .notification.error { border-left-color: var(--danger); }

        .notification.error .notification-icon { color: var(--danger); }

        

        .notification.warning { border-left-color: var(--warning); }

        .notification.warning .notification-icon { color: var(--warning); }

        

        .notification.info { border-left-color: var(--primary); }

        .notification.info .notification-icon { color: var(--primary); }



        /* NEW styles for mobile submission card */

        .submission-card-mobile {

            display: flex;

            flex-direction: column;

            gap: 12px;

            padding: 16px;

            position: relative;

        }



        .submission-card-mobile .card-header-mobile {

             display: flex;

             justify-content: space-between;

             align-items: flex-start;

             padding: 0 0 12px 0;

             border-bottom: 1px solid var(--gray-200);

        }



        .submission-card-mobile h4 {

            font-size: 16px;

            font-weight: 600;

            color: var(--gray-800);

            margin-bottom: 4px;

        }



        .submission-card-mobile .submission-id {

            font-size: 12px;

            font-weight: 700;

            color: var(--primary);

            background: rgba(99, 102, 241, 0.1);

            padding: 4px 8px;

            border-radius: var(--radius-sm);

        }

        

        .submission-card-mobile .submission-details-mobile {

            display: grid;

            grid-template-columns: 1fr;

            gap: 8px;

            font-size: 14px;

            color: var(--gray-600);

        }



        .submission-card-mobile .submission-details-mobile span {

            display: flex;

            align-items: center;

            gap: 8px;

        }

        

        .submission-card-mobile .submission-details-mobile i {

            width: 16px;

            text-align: center;

            color: var(--gray-500);

        }



        .submission-card-mobile .submission-actions {

            display: flex;

            gap: 10px;

            margin-top: 12px;

            border-top: 1px solid var(--gray-200);

            padding-top: 12px;

        }

        

        .submission-card-mobile .submission-actions .btn {

            flex: 1; /* Make buttons take equal space */

        }





        /* Mobile Menu Toggle */

        .mobile-menu-toggle {

            display: flex;

            width: 40px;

            height: 40px;

            border: none;

            background: none;

            color: var(--gray-700);

            cursor: pointer;

            border-radius: var(--radius);

            transition: var(--transition);

            align-items: center;

            justify-content: center;

        }



        .mobile-menu-toggle:hover {

            background: var(--gray-100);

        }



        /* Quick Actions Floating Button */

        .fab {

            position: fixed;

            bottom: 24px;

            right: 24px;

            width: 56px;

            height: 56px;

            background: var(--gradient-primary);

            border: none;

            border-radius: 50%;

            color: white;

            font-size: 24px;

            cursor: pointer;

            box-shadow: var(--shadow-lg);

            transition: var(--transition);

            z-index: 100;

            display: flex;

            align-items: center;

            justify-content: center;

        }



        .fab:hover {

            transform: scale(1.1);

            box-shadow: var(--shadow-xl);

        }



        /* Progressive Enhancement */

        .enhanced-card {

            background: var(--gradient-card);

            backdrop-filter: blur(20px);

            border: 1px solid rgba(255, 255, 255, 0.2);

        }



        /* Micro-interactions */

        .interactive-element:hover {

            transform: translateY(-1px);

        }



        .interactive-element:active {

            transform: translateY(0);

        }



        /* Modern Scrollbar */

        ::-webkit-scrollbar {

            width: 6px;

        }



        ::-webkit-scrollbar-track {

            background: var(--gray-100);

            border-radius: 4px;

        }



        ::-webkit-scrollbar-thumb {

            background: var(--gray-300);

            border-radius: 4px;

        }



        ::-webkit-scrollbar-thumb:hover {

            background: var(--gray-400);

        }



        /* Toggle Switch Component */

        .toggle-switch {

            position: relative;

            display: inline-block;

            width: 44px;

            height: 24px;

        }

        

        .toggle-switch input {

            opacity: 0;

            width: 0;

            height: 0;

        }

        

        .toggle-switch .slider {

            position: absolute;

            cursor: pointer;

            top: 0;

            left: 0;

            right: 0;

            bottom: 0;

            background-color: var(--gray-300);

            transition: var(--transition);

            border-radius: 24px;

        }

        

        .toggle-switch .slider:before {

            position: absolute;

            content: "";

            height: 20px;

            width: 20px;

            left: 2px;

            bottom: 2px;

            background-color: white;

            transition: var(--transition);

            border-radius: 50%;

            box-shadow: var(--shadow-sm);

        }

        

        .toggle-switch input:checked + .slider {

            background-color: var(--primary);

        }

        

        .toggle-switch input:checked + .slider:before {

            transform: translateX(20px);

        }



        /* Login message styling */

        .login-message {

            margin-top: 16px;

            padding: 12px 16px;

            border-radius: var(--radius);

            text-align: center;

            display: none;

            font-weight: 500;

        }

        

        .login-error {

            background-color: #fef2f2;

            color: var(--danger);

            border: 1px solid #fecaca;

        }

        

        .login-success {

            background-color: #f0fdf4;

            color: var(--success);

            border: 1px solid #bbf7d0;

        }



        /* Auto-refresh controls */

        .auto-refresh-controls {

            display: flex;

            align-items: center;

            gap: 12px;

            padding: 16px;

            background: var(--surface);

            border-bottom: 1px solid var(--gray-200);

            flex-wrap: wrap;

            box-shadow: var(--shadow-sm);

        }

        

        .auto-refresh-controls label {

            font-weight: 600;

            color: var(--gray-700);

            font-size: 14px;

        }

        

        .auto-refresh-controls input {

            width: 70px;

            padding: 8px 12px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            text-align: center;

            font-size: 14px;

            transition: var(--transition);

        }

        

        .auto-refresh-controls input:focus {

            border-color: var(--primary);

            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);

        }

        

        .status-indicator {

            display: inline-block;

            width: 10px;

            height: 10px;

            border-radius: 50%;

            margin-right: 8px;

            animation: pulse 2s infinite;

        }

        

        .status-live {

            background: var(--success);

        }

        

        .status-paused {

            background: var(--danger);

        }



        /* Session info */

        .session-info {

            display: flex;

            justify-content: space-between;

            padding: 12px 16px;

            background: var(--gray-50);

            border-bottom: 1px solid var(--gray-200);

            font-size: 13px;

            color: var(--gray-600);

            flex-wrap: wrap;

        }



        /* Table controls */

        .table-controls {

            padding: 16px;

            display: flex;

            gap: 16px;

            align-items: center;

            flex-wrap: wrap;

            background: var(--surface);

            border-bottom: 1px solid var(--gray-200);

            box-shadow: var(--shadow-sm);

        }

        

        .search-input {

            flex: 1;

            min-width: 100%;

        }

        

        .search-input input {

            width: 100%;

            padding: 12px 40px 12px 16px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            font-size: 16px; /* Prevent zoom on iOS */

            transition: var(--transition);

            background: var(--gray-50);

        }

        

        .search-input input:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);

            background: var(--surface);

        }

        

        .search-input i {

            position: absolute;

            right: 16px;

            top: 50%;

            transform: translateY(-50%);

            color: var(--gray-500);

        }

        

        .filter-controls {

            display: flex;

            gap: 12px;

            flex-wrap: wrap;

            width: 100%;

        }

        

        .filter-select {

            padding: 12px 16px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            background: var(--gray-50);

            font-size: 16px; /* Prevent zoom on iOS */

            transition: var(--transition);

            flex: 1;

        }

        

        .filter-select:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);

            background: var(--surface);

        }

        

        .date-range-filter {

            display: flex;

            gap: 12px;

            align-items: center;

            width: 100%;

        }

        

        .date-input {

            padding: 12px 16px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            background: var(--gray-50);

            font-size: 16px; /* Prevent zoom on iOS */

            width: 100%;

            transition: var(--transition);

        }

        

        .date-input:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);

            background: var(--surface);

        }



        /* Bulk actions */

        .bulk-actions {

            display: flex;

            align-items: center;

            gap: 10px;

            width: 100%;

        }



        /* Action buttons */

        .action-btn {

            padding: 10px 14px;

            border-radius: var(--radius-sm);

            font-size: 14px;

            margin-right: 6px;

            cursor: pointer;

            transition: var(--transition);

            box-shadow: var(--shadow-sm);

            font-weight: 600;

            border: none;

            min-height: 40px;

        }

        

        .view-btn {

            background-color: var(--primary);

            color: white;

        }

        

        .view-btn:hover {

            background-color: var(--primary-dark);

            transform: translateY(-1px);

        }

        

        .delete-btn-sm {

            background-color: var(--danger);

            color: white;

        }

        

        .delete-btn-sm:hover {

            background-color: #dc2626;

            transform: translateY(-1px);

        }



        /* Submission details */

        .submission-details {

            padding: 20px;

            border-top: 1px solid var(--gray-200);

            display: none;

            position: relative;

            animation: fadeIn 0.3s ease;

            background: var(--surface);

            margin: 16px 0;

            border-radius: var(--radius);

            box-shadow: var(--shadow-sm);

        }

        

        .submission-details h3 {

            margin-bottom: 16px;

            color: var(--primary);

            padding-right: 40px;

            font-weight: 600;

            font-size: 18px;

            display: flex;

            align-items: center;

            gap: 10px;

        }

        

        .detail-row {

            display: flex;

            flex-direction: column;

            margin-bottom: 16px;

            padding: 12px 0;

            border-bottom: 1px solid var(--gray-100);

        }

        

        .detail-row:last-child {

            border-bottom: none;

        }

        

        .detail-label {

            font-weight: 600;

            width: 100%;

            color: var(--gray-600);

            flex-shrink: 0;

            margin-bottom: 4px;

        }

        

        .detail-content {

            flex: 1;

            word-break: break-word;

            color: var(--gray-800);

        }

        

        .close-details {

            position: absolute;

            top: 20px;

            right: 20px;

            background: var(--danger);

            color: white;

            border: none;

            width: 32px;

            height: 32px;

            border-radius: 50%;

            cursor: pointer;

            font-size: 18px;

            line-height: 1;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: var(--transition);

            box-shadow: var(--shadow-sm);

        }

        

        .close-details:hover {

            background: #dc2626;

            transform: scale(1.1);

        }



        /* Last refreshed */

        .last-refreshed {

            text-align: center;

            padding: 12px 16px;

            font-size: 13px;

            color: var(--gray-500);

            background: var(--gray-50);

            border-top: 1px solid var(--gray-200);

        }



        /* Empty state */

        .empty-state {

            text-align: center;

            padding: 40px 20px;

            color: var(--gray-500);

        }

        

        .empty-state i {

            font-size: 40px;

            margin-bottom: 16px;

            opacity: 0.5;

        }

        

        .empty-state p {

            font-size: 16px;

        }



        /* Chat management */

        .chat-management {

            padding: 0;

        }

        

        .chat-management h2 {

            color: var(--gray-800);

            margin-bottom: 20px;

            display: flex;

            align-items: center;

            gap: 12px;

            font-weight: 600;

            font-size: 20px;

        }

        

        .search-controls {

            display: flex;

            gap: 12px;

            margin-bottom: 20px;

            flex-wrap: wrap;

        }

        

        .search-controls input,

        .search-controls select {

            padding: 12px 16px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            font-size: 16px; /* Prevent zoom on iOS */

            flex: 1;

            transition: var(--transition);

            background: var(--gray-50);

        }

        

        .search-controls input:focus,

        .search-controls select:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);

            background: var(--surface);

        }

        

        .chats-list {

            display: grid;

            grid-template-columns: 1fr;

            gap: 16px;

        }

        

        .chat-item {

            background: var(--surface);

            border-radius: var(--radius-lg);

            box-shadow: var(--shadow-sm);

            padding: 16px;

            display: flex;

            flex-direction: column;

            transition: var(--transition);

            position: relative;

            overflow: hidden;

            border: 1px solid var(--gray-200);

        }

        

        .chat-item:hover {

            transform: translateY(-5px);

            box-shadow: var(--shadow-md);

        }

        

        .chat-item::before {

            content: '';

            position: absolute;

            top: 0;

            left: 0;

            width: 4px;

            height: 100%;

        }

        

        .chat-item.pending::before {

            background: var(--warning);

        }

        

        .chat-item.active::before {

            background: var(--success);

        }

        

        .chat-item.resolved::before {

            background: var(--primary);

        }

        

        .chat-item.deleted::before {

            background: var(--danger);

        }

        

        .chat-info {

            flex: 1;

            margin-bottom: 16px;

        }

        

        .chat-info h4 {

            margin: 0 0 8px 0;

            color: var(--gray-800);

            font-weight: 600;

            font-size: 16px;

        }

        

        .chat-info p {

            margin: 4px 0;

            color: var(--gray-600);

            font-size: 14px;

        }

        

        .chat-info small {

            display: block;

            margin: 4px 0;

            color: var(--gray-500);

            font-size: 12px;

        }

        

        .chat-status {

            display: inline-block;

            padding: 6px 12px;

            border-radius: 20px;

            font-size: 12px;

            font-weight: 600;

            margin-bottom: 8px;

        }

        

        .status-pending {

            background: rgba(245, 158, 11, 0.1);

            color: var(--warning);

        }

        

        .status-active {

            background: rgba(16, 185, 129, 0.1);

            color: var(--success);

        }

        

        .status-resolved {

            background: rgba(99, 102, 241, 0.1);

            color: var(--primary);

        }

        

        .status-deleted {

            background: rgba(239, 68, 68, 0.1);

            color: var(--danger);

        }

        

        .chat-actions {

            display: flex;

            gap: 8px;

        }

        

        .btn-view {

            background: var(--primary);

            color: white;

            border: none;

            padding: 10px 12px;

            border-radius: var(--radius);

            cursor: pointer;

            font-size: 14px;

            flex: 1;

            transition: var(--transition);

            box-shadow: var(--shadow-sm);

            font-weight: 600;

            min-height: 40px;

        }

        

        .btn-view:hover {

            background: var(--primary-dark);

            transform: translateY(-1px);

        }

        

        .btn-delete {

            background: var(--danger);

            color: white;

            border: none;

            padding: 10px 12px;

            border-radius: var(--radius);

            cursor: pointer;

            font-size: 14px;

            flex: 1;

            transition: var(--transition);

            box-shadow: var(--shadow-sm);

            font-weight: 600;

            min-height: 40px;

        }

        

        .btn-delete:hover:not(:disabled) {

            background: #dc2626;

            transform: translateY(-1px);

        }

        

        .btn-delete:disabled {

            background: var(--gray-300);

            cursor: not-allowed;

        }

        

        .btn-resolve {

            background: var(--success);

            color: white;

            border: none;

            padding: 10px 12px;

            border-radius: var(--radius);

            cursor: pointer;

            font-size: 14px;

            flex: 1;

            transition: var(--transition);

            box-shadow: var(--shadow-sm);

            font-weight: 600;

            min-height: 40px;

        }

        

        .btn-resolve:hover:not(:disabled) {

            background: #059669;

            transform: translateY(-1px);

        }



        /* Chat ticket modal */

        .chat-ticket-modal {

            display: none;

            position: fixed;

            z-index: 1001;

            left: 0;

            top: 0;

            width: 100%;

            height: 100%;

            overflow: auto;

            background-color: rgba(17, 24, 39, 0.75);

            animation: fadeIn 0.3s;

        }

        

        .chat-ticket-content {

            background-color: var(--surface);

            margin: 0;

            padding: 16px;

            border: 1px solid var(--gray-200);

            width: 100%;

            height: 100%;

            border-radius: 0;

            display: flex;

            flex-direction: column;

            box-shadow: none;

            animation: slideUp 0.3s ease;

        }

        

        .chat-ticket-header {

            padding-bottom: 16px;

            border-bottom: 2px solid var(--gray-200);

            position: relative;

            display: flex;

            justify-content: space-between;

            align-items: flex-start;

        }

        

        .chat-ticket-header h3 {

            margin: 0;

            color: var(--gray-800);

            font-weight: 600;

            font-size: 18px;

        }

        

        .chat-ticket-header p {

            margin: 6px 0 0;

            color: var(--gray-600);

        }

        

        .client-actions {

            display: flex;

            gap: 8px;

        }

        

        .close-ticket-modal {

            position: absolute;

            top: 0;

            right: 0;

            color: var(--gray-500);

            font-size: 24px;

            font-weight: bold;

            cursor: pointer;

            transition: var(--transition);

            width: 32px;

            height: 32px;

            display: flex;

            align-items: center;

            justify-content: center;

            border-radius: 50%;

        }

        

        .close-ticket-modal:hover {

            color: var(--danger);

            background: var(--gray-100);

        }

        

        .chat-ticket-messages {

            flex: 1;

            overflow-y: auto;

            padding: 16px;

            background-color: var(--gray-50);

            border-radius: var(--radius);

            margin: 16px 0;

            display: flex;

            flex-direction: column;

            gap: 12px;

        }

        

        .message {

            display: flex;

            align-items: flex-start;

            gap: 12px;

            max-width: 90%;

        }

        

        .message.client {

            align-self: flex-start;

        }

        

        .message.admin {

            align-self: flex-end;

            flex-direction: row-reverse;

        }

        

        .message-avatar {

            width: 40px;

            height: 40px;

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            flex-shrink: 0;

            color: white;

            font-size: 16px;

        }

        

        .message.client .message-avatar {

            background-color: var(--primary);

        }

        

        .message.admin .message-avatar {

            background-color: var(--success);

        }

        

        .message-bubble {

            padding: 12px 16px;

            border-radius: 18px;

            max-width: 100%;

            box-shadow: var(--shadow-sm);

        }

        

        .message.client .message-bubble {

            background-color: var(--surface);

            border-top-left-radius: 4px;

            color: var(--gray-800);

        }

        

        .message.admin .message-bubble {

            background-color: var(--success);

            border-top-right-radius: 4px;

            color: white;

        }

        

        .message-text {

            word-break: break-word;

            line-height: 1.4;

        }

        

        .message-info {

            font-size: 11px;

            margin-top: 6px;

            opacity: 0.8;

            display: flex;

            justify-content: space-between;

        }

        

        .message-time {

            font-style: italic;

        }

        

        .message-status {

            display: flex;

            align-items: center;

            gap: 3px;

        }

        

        .date-divider {

            text-align: center;

            margin: 16px 0;

            position: relative;

        }

        

        .date-divider span {

            background: var(--surface);

            padding: 5px 15px;

            border-radius: 20px;

            font-size: 12px;

            color: var(--gray-500);

            border: 1px solid var(--gray-200);

        }

        

        .chat-ticket-reply {

            display: flex;

            gap: 12px;

            padding-top: 16px;

            border-top: 1px solid var(--gray-200);

        }

        

        #ticket-reply-input {

            flex: 1;

            padding: 12px 16px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            resize: none;

            font-size: 16px; /* Prevent zoom on iOS */

            transition: var(--transition);

            min-height: 60px;

            font-family: inherit;

            background: var(--gray-50);

        }

        

        #ticket-reply-input:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);

            background: var(--surface);

        }

        

        .chat-ticket-actions {

            margin-top: 16px;

            display: flex;

            gap: 12px;

        }



        /* Settings */

        .settings-container {

            max-width: 100%;

            margin: 0 auto;

        }

        

        .settings-card {

            background: var(--surface);

            padding: 20px;

            border-radius: var(--radius-lg);

            box-shadow: var(--shadow-sm);

            margin-bottom: 20px;

            border: 1px solid var(--gray-200);

            transition: var(--transition);

        }

        

        .settings-card:hover {

            box-shadow: var(--shadow-md);

        }

        

        .settings-card h3 {

            margin-bottom: 16px;

            color: var(--gray-800);

            display: flex;

            align-items: center;

            gap: 12px;

            padding-bottom: 16px;

            border-bottom: 1px solid var(--gray-200);

            font-weight: 600;

            font-size: 18px;

        }

        

        .setting-item {

            display: flex;

            justify-content: space-between;

            align-items: center;

            padding: 16px 0;

            border-bottom: 1px solid var(--gray-200);

        }

        

        .setting-item:last-child {

            border-bottom: none;

        }

        

        .setting-info {

            flex: 1;

        }

        

        .setting-info h4 {

            margin-bottom: 6px;

            color: var(--gray-800);

            font-weight: 600;

            font-size: 16px;

        }

        

        .setting-info p {

            color: var(--gray-600);

            font-size: 14px;

        }



        /* Pagination */

        .pagination {

            display: flex;

            justify-content: center;

            padding: 20px;

            gap: 12px;

            align-items: center;

            background: var(--surface);

            border-top: 1px solid var(--gray-200);

            flex-wrap: wrap;

        }

        

        .pagination button {

            padding: 10px 16px;

            background: var(--primary);

            color: white;

            border: none;

            border-radius: var(--radius);

            cursor: pointer;

            transition: var(--transition);

            box-shadow: var(--shadow-sm);

            font-weight: 600;

            min-height: 40px;

        }

        

        .pagination button:hover:not(:disabled) {

            background: var(--primary-dark);

            transform: translateY(-1px);

        }

        

        .pagination button:disabled {

            background: var(--gray-300);

            cursor: not-allowed;

        }

        

        .pagination span {

            font-size: 14px;

            color: var(--gray-700);

            font-weight: 600;

        }

        

        .pagination select {

            padding: 10px;

            border: 1px solid var(--gray-300);

            border-radius: var(--radius);

            transition: var(--transition);

            background: var(--gray-50);

            min-height: 40px;

        }

        

        .pagination select:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);

            background: var(--surface);

        }



        /* Loading overlay */

        .loading-overlay {

            position: absolute;

            top: 0;

            left: 0;

            right: 0;

            bottom: 0;

            background: rgba(255, 255, 255, 0.9);

            justify-content: center;

            align-items: center;

            z-index: 1000;

            display: none;

            border-radius: var(--radius);

        }

        

        .table-container {

            position: relative;

            min-height: 200px;

            background: var(--surface);

            border-radius: var(--radius);

            box-shadow: var(--shadow-sm);

            overflow: hidden;

        }



        /* Modal loading */

        .modal-loading {

            position: absolute;

            top: 0;

            left: 0;

            right: 0;

            bottom: 0;

            background: rgba(255, 255, 255, 0.8);

            display: flex;

            justify-content: center;

            align-items: center;

            z-index: 1000;

            border-radius: var(--radius-lg);

        }



        .modal-loading .spinner {

            width: 40px;

            height: 40px;

            border: 4px solid #f3f3f3;

            border-top: 4px solid var(--primary);

            border-radius: 50%;

            animation: spin 1s linear infinite;

        }



        button:disabled {

            opacity: 0.6;

            cursor: not-allowed;

            transform: none !important;

        }



        button:disabled:hover {

            transform: none !important;

        }



        /* Animations */

        @keyframes fadeIn {

            from { opacity: 0; }

            to { opacity: 1; }

        }

        

        @keyframes pulse {

            0% { opacity: 1; transform: scale(1); }

            50% { opacity: 0.5; transform: scale(0.8); }

            100% { opacity: 1; transform: scale(1); }

        }



        .grid-cols-2 {

            display: grid;

            grid-template-columns: 1fr;

            gap: 20px;

        }

        

        /* Backdrop for mobile menu */

        .nav-backdrop {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: rgba(0, 0, 0, 0.5);

            z-index: 80;

            animation: fadeIn 0.3s ease;

        }

        

        .nav-backdrop.show {

            display: block;

        }

        

        /* Prevent body scroll when menu is open */

        body.menu-open {

            overflow: hidden;

        }

        

        /* Improved touch interactions */

        @media (hover: none) {

            .btn:hover, .nav-item:hover, .dropdown-item:hover, .action-btn:hover {

                transform: none;

            }

            

            .stat-card:hover, .card:hover, .chat-item:hover {

                transform: none;

                box-shadow: var(--shadow-sm);

            }

        }

        

        /* Connection status removed */

        .connection-status-icon {

            display: none !important;

        }


        /* Bookings Styles */
        .bookings-container {
            max-width: 100%;
            margin: 0 auto;
        }

        .bookings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .bookings-header h2 {
            color: var(--gray-800);
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bookings-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .bookings-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            background: var(--gradient-primary);
        }

        .stat-content h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
            margin: 0;
        }

        .stat-content p {
            color: var(--gray-600);
            font-size: 14px;
            margin: 4px 0 0 0;
        }

        .bookings-filters {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 14px;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--gray-800);
            font-size: 14px;
            transition: var(--transition);
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .bookings-table-container {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .bookings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .bookings-table th {
            background: var(--gray-50);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
        }

        .bookings-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
            color: var(--gray-800);
            font-size: 14px;
        }

        .bookings-table tbody tr:hover {
            background: var(--surface-hover);
        }

        .booking-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .booking-status.pending_payment {
            background: #fef3c7;
            color: #92400e;
        }

        .booking-status.paid {
            background: #d1fae5;
            color: #065f46;
        }

        .booking-status.confirmed {
            background: #dbeafe;
            color: #1e40af;
        }

        .booking-status.in_progress {
            background: #fde68a;
            color: #92400e;
        }

        .booking-status.completed {
            background: #d1fae5;
            color: #065f46;
        }

        .booking-status.cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .booking-status.payment_failed {
            background: #fef2f2;
            color: #dc2626;
        }

        .booking-status.pending_consultation {
            background: #e0e7ff;
            color: #3730a3;
        }

        /* Payment Information Styles */
        .detail-group {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
        }

        .detail-group h4 {
            color: var(--gray-800);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-group p {
            margin: 8px 0;
            color: var(--gray-700);
            font-size: 14px;
        }

        .text-green-600 {
            color: #059669;
        }

        .text-yellow-600 {
            color: #d97706;
        }

        .text-red-600 {
            color: #dc2626;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .booking-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: var(--radius);
        }

        .bookings-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 24px;
        }

        .bookings-pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #page-info {
            color: var(--gray-600);
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .bookings-header {
                flex-direction: column;
                align-items: stretch;
            }

            .bookings-actions {
                justify-content: center;
            }

            .bookings-stats {
                grid-template-columns: 1fr;
            }

            .bookings-filters {
                flex-direction: column;
            }

            .filter-group {
                min-width: auto;
            }

            .bookings-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .bookings-table {
                min-width: 600px;
            }

            /* Mobile Modal Improvements */
            .modal-content {
                max-width: 95vw !important;
                margin: 10px !important;
                max-height: 95vh !important;
            }

            .modal-header {
                padding: 16px 20px !important;
            }

            .modal-header h3 {
                font-size: 1.25rem !important;
            }

            .modal-body {
                padding: 20px !important;
                max-height: 70vh !important;
            }

            /* Mobile Table Improvements */
            .bookings-table th,
            .bookings-table td {
                padding: 8px 4px !important;
                font-size: 0.8rem !important;
            }

            .bookings-table th:first-child,
            .bookings-table td:first-child {
                position: sticky;
                left: 0;
                background: var(--surface);
                z-index: 10;
            }

            /* Mobile Button Improvements */
            .btn {
                min-height: 44px;
                padding: 12px 16px;
                font-size: 14px;
            }

            .btn-sm {
                min-height: 36px;
                padding: 8px 12px;
                font-size: 12px;
            }

            /* Mobile Form Improvements */
            .form-input,
            .form-select {
                min-height: 44px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Mobile Navigation */
            .admin-header {
                padding: 0 16px;
            }

            .logo-text {
                font-size: 1.1rem;
            }

            /* Mobile Stats Cards */
            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }

            /* Mobile Touch Improvements */
            .bookings-table tbody tr {
                min-height: 60px;
            }

            .bookings-table tbody tr:hover {
                background-color: var(--gray-50);
            }

            /* Mobile Action Buttons */
            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .action-buttons .btn {
                width: 100%;
                justify-content: center;
            }

            /* Mobile Sidebar */
            .sidebar {
                width: 280px;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            /* Mobile Chat */
            .chat-container {
                height: calc(100vh - 56px);
            }

            .chat-messages {
                padding: 12px;
            }

            .chat-input-container {
                padding: 12px;
            }

            /* Mobile Pagination */
            .pagination {
                flex-wrap: wrap;
                justify-content: center;
                gap: 4px;
            }

            .pagination .btn {
                min-width: 44px;
                min-height: 44px;
            }
        }
    </style>

</head>

<body>

    <!-- Login Section -->

    <div class="login-container" id="login-section">

        <div class="login-form">

            <div class="login-logo">

                <i class="fas fa-shield-alt"></i>

            </div>

            <h2>Welcome Back</h2>

            <div id="login-message" class="login-message"></div>

            

            <form id="login-form">

                <div class="form-group">

                    <label for="username">Username</label>

                    <div class="input-group">

                        <input type="text" id="username" placeholder="Enter your username" autocomplete="username" required>

                        <i class="fas fa-user"></i>

                    </div>

                </div>

                

                <div class="form-group">

                    <label for="password">Password</label>

                    <div class="input-group">

                        <input type="password" id="password" placeholder="Enter your password" autocomplete="current-password" required>

                        <i class="fas fa-lock"></i>

                    </div>

                </div>

                

                <button type="submit" id="login-btn" class="login-btn">

                    <span>Sign In</span>

                </button>

                

                <div id="loading" class="loading" style="display: none; justify-content: center; margin-top: 16px;">

                    <div class="spinner"></div>

                    <span>Authenticating...</span>

                </div>

            </form>

        </div>

    </div>

    

    <!-- Admin Panel -->

    <div class="admin-panel" id="admin-panel">

        <!-- Header -->

        <header class="admin-header">

            <div class="header-left">

                <button class="mobile-menu-toggle" id="mobile-menu-toggle">

                    <i class="fas fa-bars"></i>

                </button>

                

                <div class="logo-section">

                    <div class="logo-icon">

                        <i class="fas fa-sparkles"></i>

                    </div>

                    <div class="logo-text">AJK Cleaning</div>

                </div>

                

                <div class="breadcrumb">

                    <span id="current-page">Dashboard</span>

                    <i class="fas fa-chevron-right" style="font-size: 12px;"></i>

                    <span id="current-section">Overview</span>

                </div>

            </div>

            

            <div class="header-right">

                <button class="theme-toggle" id="theme-toggle">

                    <i class="fas fa-moon"></i>

                </button>

                

                <button class="btn btn-secondary notification-badge" id="refresh-btn">

                    <i class="fas fa-sync-alt"></i>

                </button>

                

                <div class="user-menu" id="user-menu">

                    <button class="user-menu-button" id="user-menu-button">

                        <div class="user-avatar">A</div>

                        <div class="user-info">

                            <div class="user-name">Admin User</div>

                            <div class="user-role">Administrator</div>

                        </div>

                        <i class="fas fa-chevron-down"></i>

                    </button>

                    <div class="dropdown-menu" id="user-dropdown">

                        <button class="dropdown-item" id="dropdown-settings">

                            <i class="fas fa-cog"></i>

                            <span>Settings</span>

                        </button>

                        <div class="dropdown-divider"></div>

                        <button class="dropdown-item" id="dropdown-logout">

                            <i class="fas fa-sign-out-alt"></i>

                            <span>Logout</span>

                        </button>

                    </div>

                </div>

            </div>

        </header>



        <!-- Sidebar Navigation -->

        <div class="nav-backdrop" id="nav-backdrop"></div>

        <nav class="admin-nav" id="admin-nav">

            <div class="nav-section">

                <div class="nav-title">Main</div>

                <button class="nav-item active" data-tab="dashboard">

                    <i class="fas fa-chart-line"></i>

                    <span>Dashboard</span>

                </button>

                <button class="nav-item" data-tab="submissions">

                    <i class="fas fa-file-alt"></i>

                    <span>Submissions</span>

                </button>

                <button class="nav-item" data-tab="chats">

                    <i class="fas fa-comments"></i>

                    <span>Live Chat</span>

                </button>

            </div>

            

            <div class="nav-section">

                <div class="nav-title">Management</div>

                <button class="nav-item" data-tab="team">

                    <i class="fas fa-users-cog"></i>

                    <span>Team</span>

                </button>

                <button class="nav-item" data-tab="crm">

                    <i class="fas fa-address-book"></i>

                    <span>CRM</span>

                </button>

                <button class="nav-item" data-tab="analytics">

                    <i class="fas fa-chart-pie"></i>

                    <span>Analytics</span>

                </button>

            </div>

            

            <div class="nav-section">

                <div class="nav-title">Operations</div>

                <button class="nav-item" data-tab="bookings">
                    <i class="fas fa-calendar-check"></i>
                    <span>Bookings</span>
                </button>
                <button class="nav-item" data-tab="inventory">

                    <i class="fas fa-boxes"></i>

                    <span>Inventory</span>

                </button>

                <button class="nav-item" data-tab="qa">

                    <i class="fas fa-check-double"></i>

                    <span>Quality</span>

                </button>

                <button class="nav-item" data-tab="settings">

                    <i class="fas fa-cog"></i>

                    <span>Settings</span>

                </button>

            </div>

        </nav>



        <!-- Main Content -->

        <main class="main-content">

            <!-- Auto Refresh Controls -->

            <div class="auto-refresh-controls">

                <label for="refreshInterval">Auto-Refresh (s):</label>

                <input type="number" id="refreshInterval" min="5" max="300" value="10">

                <div id="refreshStatus">

                    <span class="status-indicator status-paused"></span>

                    <span id="statusText">Auto-Refresh Paused</span>

                </div>

                <button type="button" id="autoRefreshBtn" class="btn btn-warning">

                    <i class="fas fa-clock"></i> Auto-Refresh: OFF

                </button>

                <button type="button" id="export-btn" class="btn btn-success">

                    <i class="fas fa-download"></i> Export CSV

                </button>

                <button type="button" id="reconnect-chat" class="btn btn-primary">

                    <i class="fas fa-plug"></i> Reconnect

                </button>

                <button type="button" id="logout-btn" class="btn btn-danger">

                    <i class="fas fa-sign-out-alt"></i> Logout

                </button>

            </div>

            

            <div class="session-info">

                <span>Your Session ID: <span id="session-id" class="session-id">Generating...</span></span>

                <span>Device: <span id="device-type">Detecting...</span></span>

            </div>

            

            <!-- Dashboard Tab -->

            <div id="dashboard-tab" class="tab-content active fade-in">

                <!-- Stats Grid -->

                <div class="stats-grid">

                    <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Total Submissions</div>

                            <div class="stat-icon primary">

                                <i class="fas fa-file-alt"></i>

                            </div>

                        </div>

                        <div class="stat-value" id="totalSubmissions">0</div>

                        <div class="stat-trend positive">

                            <i class="fas fa-arrow-up"></i>

                            <span id="totalTrend">0%</span> from last month

                        </div>

                    </div>

                    

                    <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Today's Orders</div>

                            <div class="stat-icon success">

                                <i class="fas fa-calendar-day"></i>

                            </div>

                        </div>

                        <div class="stat-value" id="todaySubmissions">0</div>

                        <div class="stat-trend positive">

                            <i class="fas fa-arrow-up"></i>

                            <span id="todayTrend">0%</span> from yesterday

                        </div>

                    </div>

                    

                    <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Active Chats</div>

                            <div class="stat-icon danger">

                                <i class="fas fa-comments"></i>

                            </div>

                        </div>

                        <div class="stat-value" id="activeChats">0</div>

                        <div class="stat-trend negative">

                            <i class="fas fa-arrow-down"></i>

                            <span id="chatTrend">0%</span> from yesterday

                        </div>

                    </div>

                </div>

                

                <!-- Charts Row -->

                <div class="grid-cols-2" style="margin-bottom: 24px;">

                    <div class="card">

                        <div class="card-header">

                            <h3 class="card-title">

                                <i class="fas fa-chart-bar"></i>

                                Services Overview

                            </h3>

                        </div>

                        <div class="chart-container">

                            <canvas id="serviceChart"></canvas>

                        </div>

                    </div>

                    

                    <div class="card">

                        <div class="card-header">

                            <h3 class="card-title">

                                <i class="fas fa-chart-line"></i>

                                Weekly Trends

                            </h3>

                        </div>

                        <div class="chart-container">

                            <canvas id="timelineChart"></canvas>

                        </div>

                    </div>

                </div>

                

                <!-- Recent Activity -->

                <div class="card">

                    <div class="card-header">

                        <h3 class="card-title">

                            <i class="fas fa-clock"></i>

                            Recent Activity

                        </h3>

                    </div>

                    <div class="card-body">

                        <div id="recent-activity-list">

                            <div class="empty-state">

                                <i class="fas fa-clock"></i>

                                <p>No recent activity</p>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

            

            <!-- Submissions Tab -->

            <div id="submissions-tab" class="tab-content">

                <div class="table-controls">

                    <div class="search-input">

                        <input type="text" id="search-input" placeholder="Search submissions...">

                        <i class="fas fa-search"></i>

                    </div>

                    <!-- Bulk Actions -->

                    <div class="bulk-actions">

                        <button class="btn btn-danger" id="bulk-delete-btn" disabled>

                            <i class="fas fa-trash-alt"></i> Delete Selected

                        </button>

                    </div>

                    <div class="filter-controls">

                        <select id="service-filter" class="filter-select">

                            <option value="">All Services</option>

                            <option value="Residential Cleaning">Residential Cleaning</option>

                            <option value="Commercial Cleaning">Commercial Cleaning</option>

                            <option value="Deep Cleaning">Deep Cleaning</option>

                            <option value="Move In/Out Cleaning">Move In/Out Cleaning</option>

                        </select>

                        <select id="date-filter" class="filter-select">

                            <option value="">All Dates</option>

                            <option value="today">Today</option>

                            <option value="week">This Week</option>

                            <option value="month">This Month</option>

                        </select>

                    </div>

                </div>

                

                <div class="table-container">

                    <div class="loading-overlay" id="table-loading">

                        <div class="spinner"></div>

                    </div>

                    <table id="submissionsTable" class="table">

                        <thead>

                            <tr>

                                <th><input type="checkbox" id="select-all-checkbox"></th>

                                <th data-sort="id">ID <i class="fas fa-sort"></i></th>

                                <th data-sort="name">Name <i class="fas fa-sort"></i></th>

                                <th data-sort="email">Email <i class="fas fa-sort"></i></th>

                                <th data-sort="phone">Phone <i class="fas fa-sort"></i></th>

                                <th data-sort="service">Service <i class="fas fa-sort"></i></th>

                                <th data-sort="preferred_date">Preferred Date <i class="fas fa-sort"></i></th>

                                <th>Preferred Time</th>

                                <th data-sort="date">Submitted <i class="fas fa-sort"></i></th>

                                <th>Actions</th>

                            </tr>

                        </thead>

                        <tbody>

                            <!-- Dynamic content -->

                        </tbody>

                    </table>

                </div>

                

                <!-- Pagination -->

                <div class="pagination" id="pagination-controls">

                    <button type="button" id="prev-page" disabled>Previous</button>

                    <span id="page-info">Page 1 of 1</span>

                    <button type="button" id="next-page" disabled>Next</button>

                    <select id="page-size">

                        <option value="10">10 per page</option>

                        <option value="25">25 per page</option>

                        <option value="50">50 per page</option>

                        <option value="100">100 per page</option>

                    </select>

                </div>

                

                <div id="detailView" class="submission-details">

                    <h3><i class="fas fa-info-circle"></i> Submission Details</h3>

                    <button type="button" id="close-details" class="close-details"></button>

                    

                    <div class="detail-row">

                        <div class="detail-label">ID:</div>

                        <div class="detail-content" id="detail-id">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Name:</div>

                        <div class="detail-content" id="detail-name">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Email:</div>

                        <div class="detail-content" id="detail-email">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Phone:</div>

                        <div class="detail-content" id="detail-phone">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Service:</div>

                        <div class="detail-content" id="detail-service">-</div>

                    </div>

                     <div class="detail-row">

                        <div class="detail-label">Preferred Date:</div>

                        <div class="detail-content" id="detail-preferred-date">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Preferred Time:</div>

                        <div class="detail-content" id="detail-preferred-time">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Message:</div>

                        <div class="detail-content" id="detail-message">-</div>

                    </div>

                    <div class="detail-row">

                        <div class="detail-label">Submitted:</div>

                        <div class="detail-content" id="detail-date">-</div>

                    </div>

                </div>

                

                <div class="last-refreshed" id="lastRefreshed">

                    Last refreshed: Never

                </div>

            </div>

            

            <!-- Chat Tab -->

            <div id="chats-tab" class="tab-content">

                <div class="chat-management">

                    <h2><i class="fas fa-comments"></i> Chat Management</h2>

                    

                    <div class="search-controls">

                        <input type="text" id="chat-search-management" placeholder="Search chats...">

                        <select id="chat-filter">

                            <option value="all">All Chats</option>

                            <option value="pending">Pending</option>

                            <option value="active">Active</option>

                            <option value="resolved">Resolved</option>

                        </select>

                        <select id="chat-sort">

                            <option value="newest">Newest First</option>

                            <option value="oldest">Oldest First</option>

                            <option value="most-active">Most Active</option>

                        </select>

                    </div>

                    

                    <div class="chats-list" id="chats-list">

                        <div class="empty-state">

                            <i class="fas fa-comments"></i>

                            <p>Loading chat history...</p>

                        </div>

                    </div>

                </div>

            </div>

            

            <!-- Other Tabs (Coming Soon) -->

            <div id="team-tab" class="tab-content">

                <div class="card">

                    <div class="card-body" style="text-align: center; padding: 40px 20px;">

                        <div style="font-size: 40px; color: var(--gray-400); margin-bottom: 20px;">

                            <i class="fas fa-users-cog"></i>

                        </div>

                        <h3 style="color: var(--gray-700); margin-bottom: 16px;">Team Management</h3>

                        <p style="color: var(--gray-600); max-width: 400px; margin: 0 auto;">Advanced team scheduling, performance tracking, and resource management tools are coming soon.</p>

                    </div>

                </div>

            </div>

            

            <div id="crm-tab" class="tab-content">

                <div class="card">

                    <div class="card-body" style="text-align: center; padding: 40px 20px;">

                        <div style="font-size: 40px; color: var(--gray-400); margin-bottom: 20px;">

                            <i class="fas fa-address-book"></i>

                        </div>

                        <h3 style="color: var(--gray-700); margin-bottom: 16px;">Customer Relationship Management</h3>

                        <p style="color: var(--gray-600); max-width: 400px; margin: 0 auto;">Customer insights, service history, and automated follow-up features are in development.</p>

                    </div>

                </div>

            </div>

            

            <div id="analytics-tab" class="tab-content">

                <div class="stats-grid">

                     <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Real-Time Users</div>

                            <div class="stat-icon primary"><i class="fas fa-users"></i></div>

                        </div>

                        <div class="stat-value" id="realtime-users">0</div>

                         <div class="stat-trend positive"><span>Live on site</span></div>

                    </div>

                    <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Total Visits (24h)</div>

                            <div class="stat-icon success"><i class="fas fa-eye"></i></div>

                        </div>

                        <div class="stat-value" id="total-visits">0</div>

                        <div class="stat-trend positive"><span>vs. previous 24h</span></div>

                    </div>

                    <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Avg. Visit Duration</div>

                            <div class="stat-icon warning"><i class="fas fa-clock"></i></div>

                        </div>

                        <div class="stat-value" id="avg-duration">0s</div>

                        <div class="stat-trend positive"><span>All time average</span></div>

                    </div>

                     <div class="stat-card">

                        <div class="stat-header">

                            <div class="stat-title">Bounce Rate</div>

                            <div class="stat-icon danger"><i class="fas fa-external-link-alt"></i></div>

                        </div>

                        <div class="stat-value" id="bounce-rate">0%</div>

                         <div class="stat-trend negative"><span>Lower is better</span></div>

                    </div>

                </div>



                <div class="grid-cols-2" style="margin-bottom: 24px;">

                    <div class="card">

                        <div class="card-header">

                            <h3 class="card-title"><i class="fas fa-globe-americas"></i> Visitors by Country</h3>

                        </div>

                        <div class="chart-container">

                            <canvas id="country-chart"></canvas>

                        </div>

                    </div>

                    <div class="card">

                        <div class="card-header">

                            <h3 class="card-title"><i class="fas fa-mouse-pointer"></i> Traffic Sources</h3>

                        </div>

                        <div class="chart-container">

                            <canvas id="traffic-source-chart"></canvas>

                        </div>

                    </div>

                </div>

                 <div class="card">

                    <div class="card-header">

                        <h3 class="card-title"><i class="fas fa-chart-line"></i> Page Views (Last 7 Days)</h3>

                    </div>

                    <div class="chart-container" style="height: 300px;">

                        <canvas id="page-views-chart"></canvas>

                    </div>

                </div>

            </div>

            

            <div id="inventory-tab" class="tab-content">

                <div class="card">

                    <div class="card-body" style="text-align: center; padding: 40px 20px;">

                        <div style="font-size: 40px; color: var(--gray-400); margin-bottom: 20px;">

                            <i class="fas fa-boxes"></i>

                        </div>

                        <h3 style="color: var(--gray-700); margin-bottom: 16px;">Inventory Management</h3>

                        <p style="color: var(--gray-600); max-width: 400px; margin: 0 auto;">Supply tracking, automatic reordering, and cost optimization tools are coming soon.</p>

                    </div>

                </div>

            </div>

            

            <div id="qa-tab" class="tab-content">

                <div class="card">

                    <div class="card-body" style="text-align: center; padding: 40px 20px;">

                        <div style="font-size: 40px; color: var(--gray-400); margin-bottom: 20px;">

                            <i class="fas fa-check-double"></i>

                        </div>

                        <h3 style="color: var(--gray-700); margin-bottom: 16px;">Quality Assurance</h3>

                        <p style="color: var(--gray-600); max-width: 400px; margin: 0 auto;">Quality checklists, customer feedback analysis, and performance scoring are in development.</p>

                    </div>

                </div>

            </div>

            

            <div id="settings-tab" class="tab-content">

                <div class="settings-container">

                    <div class="settings-card">

                        <h3><i class="fas fa-bell"></i> Notification Settings</h3>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Email Notifications</h4>

                                <p>Receive email alerts for new submissions and messages</p>

                            </div>

                            <label class="toggle-switch">

                                <input type="checkbox" id="email-notifications" checked>

                                <span class="slider"></span>

                            </label>

                        </div>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Desktop Notifications</h4>

                                <p>Show browser notifications for new activity</p>

                            </div>

                            <label class="toggle-switch">

                                <input type="checkbox" id="desktop-notifications">

                                <span class="slider"></span>

                            </label>

                        </div>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Sound Alerts</h4>

                                <p>Play sound for new messages</p>

                            </div>

                            <label class="toggle-switch">

                                <input type="checkbox" id="sound-alerts">

                                <span class="slider"></span>

                            </label>

                        </div>

                    </div>

                    

                    <div class="settings-card">

                        <h3><i class="fas fa-paint-brush"></i> Appearance Settings</h3>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Dark Mode</h4>

                                <p>Switch to dark color theme</p>

                            </div>

                            <label class="toggle-switch">

                                <input type="checkbox" id="dark-mode">

                                <span class="slider"></span>

                            </label>

                        </div>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Compact View</h4>

                                <p>Use compact layout for data tables</p>

                            </div>

                            <label class="toggle-switch">

                                <input type="checkbox" id="compact-view">

                                <span class="slider"></span>

                            </label>

                        </div>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Animation Effects</h4>

                                <p>Enable interface animations</p>

                            </div>

                            <label class="toggle-switch">

                                <input type="checkbox" id="animations" checked>

                                <span class="slider"></span>

                            </label>

                        </div>

                    </div>

                    

                    <div class="settings-card">

                        <h3><i class="fas fa-database"></i> Data Management</h3>

                        <div class="setting-item">

                            <div class="setting-info">

                                <h4>Backup Database</h4>

                                <p>Create a manual backup of critical data</p>

                            </div>

                            <button type="button" class="btn btn-primary" id="backup-btn">Backup Now</button>

                        </div>

                    </div>

                </div>

            </div>


            <!-- Bookings Tab -->
            <div id="bookings-tab" class="tab-content">
                <div class="bookings-container">
                    <div class="bookings-header">
                        <h2><i class="fas fa-calendar-check"></i> Bookings Management</h2>
                        <div class="bookings-actions">
                            <button class="btn btn-primary" id="refresh-bookings">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-secondary" id="export-bookings">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="bookings-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-plus"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="total-bookings">0</h3>
                                <p>Total Bookings</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="total-revenue">0</h3>
                                <p>Total Revenue</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="pending-bookings">0</h3>
                                <p>Pending</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="completed-bookings">0</h3>
                                <p>Completed</p>
                            </div>
                        </div>
                    </div>

                    <div class="bookings-filters">
                        <div class="filter-group">
                            <label for="status-filter">Status:</label>
                            <select id="status-filter" class="filter-select">
                                <option value="">All Status</option>
                                <option value="pending_payment">Pending Payment</option>
                                <option value="paid">Paid</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="payment_failed">Payment Failed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="date-filter">Date Range:</label>
                            <input type="date" id="date-from" class="filter-input">
                            <input type="date" id="date-to" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label for="search-bookings">Search:</label>
                            <input type="text" id="search-bookings" placeholder="Customer name, email, or booking ID" class="filter-input">
                        </div>
                    </div>

                    <div class="bookings-table-container">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Customer</th>
                                    <th>Service</th>
                                    <th>Date & Time</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-table-body">
                                <!-- Bookings will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="bookings-pagination">
                        <button class="btn btn-secondary" id="prev-page" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span id="page-info">Page 1 of 1</span>
                        <button class="btn btn-secondary" id="next-page">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>

    </div>

    

    <!-- Chat Ticket Modal -->

    <div id="chat-ticket-modal" class="chat-ticket-modal">

        <div class="chat-ticket-content">

            <div class="chat-ticket-header">

                <div>

                    <h3 id="ticket-client-name">Client Name</h3>

                    <p id="ticket-client-email">client@email.com</p>

                    <span class="chat-status" id="ticket-status">Pending</span>

                </div>

                <div class="client-actions">

                    <button type="button" class="btn btn-success" id="resolve-ticket">Mark Resolved</button>

                    <button type="button" class="btn btn-danger" id="delete-ticket">Delete Chat</button>

                </div>

                <span id="close-ticket-modal" class="close-ticket-modal">&times;</span>

            </div>

            <div class="chat-ticket-messages" id="ticket-messages">

                <!-- Messages will be loaded here -->

            </div>

            <div class="chat-ticket-reply">

                <textarea id="ticket-reply-input" placeholder="Type your reply..."></textarea>

                <button type="button" id="ticket-send-reply" class="btn btn-primary">Send</button>

            </div>

        </div>

    </div>

    

    <!-- Quick Actions FAB -->

    <button class="fab" id="quick-actions">

        <i class="fas fa-plus"></i>

    </button>

    

    <div id="notification-container" class="notification-container"></div>



    <script>

        // Admin Panel JavaScript

        class ModernAdminPanel {

            constructor() {

                this.currentTheme = 'light';

                this.currentTab = 'dashboard';

                this.isAuthenticated = false;

                this.autoRefreshInterval = null;

                this.autoRefreshEnabled = false;

                this.isRefreshing = false;

                this.chatSocket = null;

                this.sessionId = this.generateSessionId();

                this.submissions = []; // This will now hold only the current page's data

                this.currentPage = 1;

                this.pageSize = 10;

                this.totalPages = 1;

                this.sortField = 'id';

                this.sortDirection = 'desc';

                this.searchTerm = '';

                this.serviceFilter = '';

                this.dateFilter = '';

                this.chats = [];

                this.selectedChatId = null;

                this.filteredChats = [];

                this.stats = {};

                this.minimalConnectionStatus = true; // Hide connection status



                // Chart instances for analytics

                this.countryChart = null;

                this.trafficSourceChart = null;

                this.pageViewsChart = null;

                

                this.init();

            }



            init() {

                this.setupEventListeners();

                this.initializeCharts();

                this.checkAuthStatus();

                this.setupSessionMonitoring();

                this.optimizeMobileLayout();

            }



            async fetchWithCSRF(url, options = {}) {

                const csrfToken = this.getCSRFToken();

                

                const defaultOptions = {

                    credentials: 'include',

                    headers: {

                        'CSRF-Token': csrfToken,

                        'X-CSRF-Token': csrfToken,

                        ...(options.headers || {})

                    }

                };

                

                if (options.body && typeof options.body !== 'string') {

                    defaultOptions.headers['Content-Type'] = 'application/json';

                    options.body = JSON.stringify(options.body);

                }



                return fetch(url, { ...options, ...defaultOptions });

            }

            

            setupSessionMonitoring() {

                const SESSION_DURATION = 24 * 60 * 60 * 1000;

                const WARNING_BEFORE = 5 * 60 * 1000;

                let lastActivity = Date.now();

                

                ['click', 'keypress', 'scroll', 'mousemove'].forEach(event => {

                    document.addEventListener(event, () => {

                        lastActivity = Date.now();

                    }, { passive: true });

                });

                

                setInterval(() => {

                    if(!this.isAuthenticated) return;

                    const elapsed = Date.now() - lastActivity;

                    const remaining = SESSION_DURATION - elapsed;

                    

                    if (remaining <= WARNING_BEFORE && remaining > (WARNING_BEFORE - 60000)) {

                        this.showNotification(

                            `Your session will expire in about ${Math.ceil(remaining / 60000)} minutes due to inactivity.`,

                            'warning'

                        );

                    } else if (remaining <= 0) {

                        this.logout('Session expired due to inactivity.');

                    }

                }, 60000);

            }



            generateSessionId() {

                const existing = sessionStorage.getItem('adminSessionId');

                if (existing) {

                    return existing;

                }

                const timestamp = Date.now();

                const random = Math.random().toString(36).substr(2, 9);

                const userAgent = navigator.userAgent.substr(0, 20).replace(/[^a-zA-Z0-9]/g, '');

                

                const sessionId = `admin_${timestamp}_${random}_${userAgent}`;

                sessionStorage.setItem('adminSessionId', sessionId);

                

                return sessionId;

            }



            detectDeviceType() {

                const userAgent = navigator.userAgent;

                

                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {

                    return 'Mobile';

                } else {

                    return 'Desktop';

                }

            }



            optimizeMobileLayout() {

                if (this.detectDeviceType() === 'Mobile') {

                    document.body.classList.add('mobile-device');

                    // Close sidebar by default on mobile

                    this.closeMobileMenu();

                }

            }



            setupEventListeners() {

                document.getElementById('login-form')?.addEventListener('submit', (e) => {

                    e.preventDefault();

                    this.handleLogin();

                });



                document.querySelectorAll('.nav-item').forEach(item => {

                    item.addEventListener('click', () => {

                        this.switchTab(item.dataset.tab);

                        this.closeMobileMenu();

                    });

                });



                document.getElementById('theme-toggle')?.addEventListener('click', () => {

                    this.toggleTheme();

                });



                document.getElementById('mobile-menu-toggle')?.addEventListener('click', () => {

                    this.toggleMobileMenu();

                });

                

                document.getElementById('nav-backdrop')?.addEventListener('click', () => {

                    this.closeMobileMenu();

                });

                

                document.getElementById('user-menu-button').addEventListener('click', () => {

                    document.getElementById('user-dropdown').classList.toggle('show');

                });

                

                document.getElementById('dropdown-settings').addEventListener('click', () => {

                    this.switchTab('settings');

                    document.getElementById('user-dropdown').classList.remove('show');

                });

                

                document.getElementById('dropdown-logout').addEventListener('click', () => this.logout());





                document.getElementById('refresh-btn')?.addEventListener('click', () => {

                    this.refreshData(false); // Manual refresh

                });



                document.getElementById('autoRefreshBtn')?.addEventListener('click', () => {

                    this.toggleAutoRefresh();

                });


                // Bookings event listeners
                document.getElementById('refresh-bookings')?.addEventListener('click', () => {
                    this.loadBookings();
                });

                document.getElementById('export-bookings')?.addEventListener('click', () => {
                    this.exportBookings();
                });

                document.getElementById('status-filter')?.addEventListener('change', (e) => {
                    this.statusFilter = e.target.value;
                    this.currentPage = 1;
                    this.loadBookings();
                });

                document.getElementById('date-from')?.addEventListener('change', (e) => {
                    this.dateFrom = e.target.value;
                    this.currentPage = 1;
                    this.loadBookings();
                });

                document.getElementById('date-to')?.addEventListener('change', (e) => {
                    this.dateTo = e.target.value;
                    this.currentPage = 1;
                    this.loadBookings();
                });

                document.getElementById('search-bookings')?.addEventListener('input', 
                    this.debounce((e) => {
                        this.searchTerm = e.target.value;
                        this.currentPage = 1;
                        this.loadBookings();
                    }, 300)
                );

                document.getElementById('prev-page')?.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.loadBookings();
                    }
                });

                document.getElementById('next-page')?.addEventListener('click', () => {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                        this.loadBookings();
                    }
                });


                document.getElementById('export-btn')?.addEventListener('click', () => {

                    this.exportCSV();

                });



                document.getElementById('reconnect-chat')?.addEventListener('click', () => {

                    this.initializeChatSocket();

                });



                document.getElementById('logout-btn')?.addEventListener('click', () => {

                    this.logout();

                });



                document.getElementById('refreshInterval')?.addEventListener('change', () => {

                    if (this.autoRefreshEnabled) {

                        this.startAutoRefresh();

                    }

                });



                document.getElementById('search-input').addEventListener('input', this.debounce(() => {

                    this.searchTerm = document.getElementById('search-input').value;

                    this.currentPage = 1;

                    this.loadSubmissions();

                }, 300));



                document.getElementById('service-filter').addEventListener('change', () => {

                    this.serviceFilter = document.getElementById('service-filter').value;

                    this.currentPage = 1;

                    this.loadSubmissions();

                });



                document.getElementById('date-filter').addEventListener('change', () => {

                    this.dateFilter = document.getElementById('date-filter').value;

                    this.currentPage = 1;

                    this.loadSubmissions();

                });



                document.getElementById('prev-page').addEventListener('click', () => {

                    if (this.currentPage > 1) {

                        this.currentPage--;

                        this.loadSubmissions();

                    }

                });



                document.getElementById('next-page').addEventListener('click', () => {

                    if (this.currentPage < this.totalPages) {

                        this.currentPage++;

                        this.loadSubmissions();

                    }

                });



                document.getElementById('page-size').addEventListener('change', (e) => {

                    this.pageSize = parseInt(e.target.value);

                    this.currentPage = 1;

                    this.loadSubmissions();

                });



                document.querySelectorAll('th[data-sort]').forEach(th => {

                    th.addEventListener('click', () => {

                        const field = th.getAttribute('data-sort');

                        if (this.sortField === field) {

                            this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';

                        } else {

                            this.sortField = field;

                            this.sortDirection = 'desc';

                        }

                        this.loadSubmissions();

                    });

                });



                if (document.getElementById('chat-search-management')) {

                    document.getElementById('chat-search-management').addEventListener('input', 

                        this.debounce((e) => {

                            this.filterChats();

                        }, 300)

                    );

                }



                if (document.getElementById('chat-filter')) {

                    document.getElementById('chat-filter').addEventListener('change', () => {

                        this.filterChats();

                    });

                }



                if (document.getElementById('chat-sort')) {

                    document.getElementById('chat-sort').addEventListener('change', () => {

                        this.filterChats();

                    });

                }



                if (document.getElementById('close-ticket-modal')) {

                    document.getElementById('close-ticket-modal').addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        document.getElementById('chat-ticket-modal').style.display = 'none';

                        this.selectedChatId = null;

                    });

                }



                if (document.getElementById('ticket-send-reply')) {

                    document.getElementById('ticket-send-reply').addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        this.sendTicketReply();

                    });

                }



                if (document.getElementById('resolve-ticket')) {

                    document.getElementById('resolve-ticket').addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        this.resolveTicket();

                    });

                }



                if (document.getElementById('delete-ticket')) {

                    document.getElementById('delete-ticket').addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        this.deleteChat(this.selectedChatId);

                    });

                }



                document.querySelectorAll('.toggle-switch input').forEach(toggle => {

                    toggle.addEventListener('change', (e) => {

                        const id = e.target.id;

                        const value = e.target.checked;

                        this.saveSetting(id, value);

                    });

                });



                if (document.getElementById('backup-btn')) {

                    document.getElementById('backup-btn').addEventListener('click', () => {

                        this.createBackup();

                    });

                }



                if (document.getElementById('select-all-checkbox')) {

                    document.getElementById('select-all-checkbox').addEventListener('change', (e) => {

                        document.querySelectorAll('.submission-checkbox').forEach(checkbox => {

                            checkbox.checked = e.target.checked;

                        });

                        this.updateBulkDeleteButton();

                    });

                }



                if (document.getElementById('bulk-delete-btn')) {

                    document.getElementById('bulk-delete-btn').addEventListener('click', () => {

                        this.handleBulkDelete();

                    });

                }



                if (document.getElementById('close-details')) {

                    document.getElementById('close-details').addEventListener('click', () => {

                        document.getElementById('detailView').style.display = 'none';

                    });

                }



                this.displaySessionInfo();

                this.setupKeyboardShortcuts();

            }



            debounce(func, wait) {

                let timeout;

                return function executedFunction(...args) {

                    const later = () => {

                        clearTimeout(timeout);

                        func(...args);

                    };

                    clearTimeout(timeout);

                    timeout = setTimeout(later, wait);

                };

            }



            displaySessionInfo() {

                const sessionIdElement = document.getElementById('session-id');

                const deviceTypeElement = document.getElementById('device-type');

                

                if (sessionIdElement) {

                    const sid = this.sessionId || '';

                    const masked = sid.length > 8 ? sid.slice(-8) : sid;

                    sessionIdElement.textContent = `${masked}`;

                }

                

                if (deviceTypeElement) {

                    deviceTypeElement.textContent = this.detectDeviceType();

                }

            }



            async checkAuthStatus() {

                try {

                    const response = await this.fetchWithCSRF('/api/admin/status');

                    

                    if (response.ok) {

                        const data = await response.json();

                        if (data.authenticated) {

                            this.isAuthenticated = true;

                            this.showAdminPanel();

                            this.loadStats();

                            this.loadSubmissions();

                            this.loadChats();

                            this.initializeChatSocket();

                            this.startAutoRefresh();

                            this.loadSettings();

                        } else {

                            this.showLoginForm();

                        }

                    } else {

                        this.showLoginForm();

                    }

                } catch (error) {

                    console.error('Auth check error:', error);

                    this.showLoginForm();

                }

            }



            async handleLogin() {

                const username = document.getElementById('username')?.value;

                const password = document.getElementById('password')?.value;

                

                if (!username || !password) {

                    this.showLoginMessage('Please enter both username and password', 'error');

                    return;

                }

                

                const loginBtn = document.getElementById('login-btn');

                const loading = document.getElementById('loading');

                

                if (loginBtn && loading) {

                    loginBtn.disabled = true;

                    loading.style.display = 'flex';

                }

                

                try {

                    const response = await this.fetchWithCSRF('/api/admin/login', {

                        method: 'POST',

                        body: {

                            username,

                            password,

                            sessionId: this.sessionId,

                            deviceType: this.detectDeviceType()

                        }

                    });

                    

                    if (response.ok) {

                        const data = await response.json();

                        this.isAuthenticated = true;

                        this.showLoginMessage('Login successful! Loading admin panel...', 'success');

                        

                        setTimeout(() => {

                            this.showAdminPanel();

                            this.loadStats();

                            this.loadSubmissions();

                            this.loadChats();

                            this.initializeChatSocket();

                            this.startAutoRefresh();

                            this.loadSettings();

                        }, 1000);

                    } else {

                        const error = await response.json();

                        this.showLoginMessage(error.error || 'Login failed', 'error');

                    }

                } catch (error) {

                    console.error('Login error:', error);

                    this.showLoginMessage('Login error. Please try again.', 'error');

                } finally {

                    if (loginBtn && loading) {

                        loginBtn.disabled = false;

                        loading.style.display = 'none';

                    }

                }

            }



            getCSRFToken() {

                const metaToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');

                const windowToken = window.CSRF_TOKEN;

                

                if (!metaToken && !windowToken) {

                    console.warn('CSRF token not found. Attempting to fetch from server...');

                    fetch('/api/csrf-token', { credentials: 'include' })

                        .then(r => r.json())

                        .then(data => {

                            window.CSRF_TOKEN = data.csrfToken;

                            let meta = document.querySelector('meta[name="csrf-token"]');

                            if (!meta) {

                                meta = document.createElement('meta');

                                meta.name = 'csrf-token';

                                document.head.appendChild(meta);

                            }

                            meta.content = data.csrfToken;

                        })

                        .catch(err => console.error('Failed to fetch CSRF token:', err));

                }

                

                return metaToken || windowToken || '';

            }



            showLoginMessage(message, type) {

                const loginMessage = document.getElementById('login-message');

                if (!loginMessage) return;

                loginMessage.textContent = message;

                loginMessage.className = `login-message ${type === 'error' ? 'login-error' : 'login-success'}`;

                loginMessage.style.display = 'block';

                setTimeout(() => {

                    loginMessage.style.display = 'none';

                }, 5000);

            }



            showAdminPanel() {

                document.getElementById('login-section').style.display = 'none';

                document.getElementById('admin-panel').style.display = 'block';

            }



            showLoginForm() {

                document.getElementById('login-section').style.display = 'flex';

                document.getElementById('admin-panel').style.display = 'none';

            }



            switchTab(tabName) {

                document.querySelectorAll('.nav-item').forEach(item => {

                    item.classList.remove('active');

                });

                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');



                document.querySelectorAll('.tab-content').forEach(content => {

                    content.classList.remove('active');

                });

                document.getElementById(`${tabName}-tab`).classList.add('active');



                const breadcrumbMap = {

                    dashboard: { page: 'Dashboard', section: 'Overview' },

                    submissions: { page: 'Submissions', section: 'All Entries' },

                    chats: { page: 'Live Chat', section: 'Active Conversations' },

                    team: { page: 'Team', section: 'Management' },

                    crm: { page: 'CRM', section: 'Customer Data' },

                    analytics: { page: 'Analytics', section: 'Reports' },

                    bookings: { page: 'Bookings', section: 'Management' },
                    inventory: { page: 'Inventory', section: 'Supplies' },

                    qa: { page: 'Quality', section: 'Assurance' },

                    settings: { page: 'Settings', section: 'Preferences' }

                };



                if (breadcrumbMap[tabName]) {

                    document.getElementById('current-page').textContent = breadcrumbMap[tabName].page;

                    document.getElementById('current-section').textContent = breadcrumbMap[tabName].section;

                }



                this.currentTab = tabName;

                

                // Auto-close sidebar on mobile after tab change

                this.closeMobileMenu();



                if (tabName === 'submissions') {

                    this.loadSubmissions();

                } else if (tabName === 'chats') {

                    this.loadChats();

                } else if (tabName === 'bookings') {
                    this.loadBookings();
                } else if (tabName === 'dashboard' || tabName === 'analytics') {

                    this.loadStats();

                    if (tabName === 'analytics') {

                        this.loadAnalyticsData();

                    }

                }

            }



            toggleTheme() {

                this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';

                this.setTheme(this.currentTheme);

            }



            setTheme(theme) {

                document.body.setAttribute('data-theme', theme);

                const themeIcon = document.querySelector('#theme-toggle i');

                const darkModeToggle = document.getElementById('dark-mode');

                

                if (theme === 'dark') {

                    themeIcon.className = 'fas fa-sun';

                    if (darkModeToggle) darkModeToggle.checked = true;

                } else {

                    themeIcon.className = 'fas fa-moon';

                    if (darkModeToggle) darkModeToggle.checked = false;

                }

                this.currentTheme = theme;

            }



            toggleMobileMenu() {

                const nav = document.getElementById('admin-nav');

                const backdrop = document.getElementById('nav-backdrop');

                

                if (nav.classList.contains('open')) {

                    this.closeMobileMenu();

                } else {

                    nav.classList.add('open');

                    backdrop.classList.add('show');

                    document.body.classList.add('menu-open');

                }

            }

            

            closeMobileMenu() {

                const nav = document.getElementById('admin-nav');

                const backdrop = document.getElementById('nav-backdrop');

                

                nav.classList.remove('open');

                backdrop.classList.remove('show');

                document.body.classList.remove('menu-open');

            }



            refreshData(isAutoRefresh = false) {

                if (this.isRefreshing) return;

                

                this.isRefreshing = true;

                const btn = document.getElementById('refresh-btn');

                const icon = btn.querySelector('i');

                

                icon.classList.add('fa-spin');

                btn.style.opacity = '0.7';

                

                const refreshPromises = [];

                

                if (this.currentTab === 'dashboard' || this.currentTab === 'analytics') {

                    refreshPromises.push(this.loadStats());

                    if(this.currentTab === 'analytics') {

                        refreshPromises.push(this.loadAnalyticsData());

                    }

                } else if (this.currentTab === 'submissions') {

                    refreshPromises.push(this.loadSubmissions());

                } else if (this.currentTab === 'chats') {

                    refreshPromises.push(this.loadChats());

                } else if (this.currentTab === 'bookings') {
                    refreshPromises.push(this.loadBookings());
                }

                

                Promise.all(refreshPromises).finally(() => {

                    setTimeout(() => {

                        icon.classList.remove('fa-spin');

                        btn.style.opacity = '1';

                        this.isRefreshing = false;

                        if (!isAutoRefresh) {

                            this.showNotification('Data refreshed successfully!', 'success');

                        }

                        this.updateLastRefreshed();

                    }, 500);

                });

            }



            updateLastRefreshed() {

                const lastRefreshed = document.getElementById('lastRefreshed');

                if (lastRefreshed) {

                    lastRefreshed.textContent = `Last refreshed: ${new Date().toLocaleTimeString()}`;

                }

            }



            toggleAutoRefresh() {

                this.autoRefreshEnabled = !this.autoRefreshEnabled;

                if (this.autoRefreshEnabled) {

                    this.startAutoRefresh();

                } else {

                    this.stopAutoRefresh();

                }

                this.updateAutoRefreshUI();

            }



            startAutoRefresh() {

                this.stopAutoRefresh();

                const interval = parseInt(document.getElementById('refreshInterval')?.value || '30') * 1000;

                if (interval < 1000) {

                    this.showNotification('Refresh interval must be at least 1 second', 'error');

                    return;

                }

                this.autoRefreshInterval = setInterval(() => this.refreshData(true), interval);

                this.autoRefreshEnabled = true;

                this.updateAutoRefreshUI();

            }



            stopAutoRefresh() {

                if (this.autoRefreshInterval) {

                    clearInterval(this.autoRefreshInterval);

                    this.autoRefreshInterval = null;

                }

                this.autoRefreshEnabled = false;

                this.updateAutoRefreshUI();

            }



            updateAutoRefreshUI() {

                const autoRefreshBtn = document.getElementById('autoRefreshBtn');

                if (autoRefreshBtn) {

                    autoRefreshBtn.innerHTML = this.autoRefreshEnabled ? 

                        '<i class="fas fa-clock"></i> Auto-Refresh: ON' : '<i class="fas fa-clock"></i> Auto-Refresh: OFF';

                    autoRefreshBtn.classList.toggle('btn-success', this.autoRefreshEnabled);

                    autoRefreshBtn.classList.toggle('btn-warning', !this.autoRefreshEnabled);

                }

                const statusText = document.getElementById('statusText');

                if (statusText) {

                    statusText.textContent = this.autoRefreshEnabled ? 

                        'Auto-Refresh Enabled' : 'Auto-Refresh Paused';

                }

                const statusIndicator = document.querySelector('#refreshStatus .status-indicator');

                if (statusIndicator) {

                    statusIndicator.classList.toggle('status-live', this.autoRefreshEnabled);

                    statusIndicator.classList.toggle('status-paused', !this.autoRefreshEnabled);

                }

            }



            async exportCSV() {

                try {

                    const response = await this.fetchWithCSRF('/api/submissions/export');

                    

                    if (response.ok) {

                        const blob = await response.blob();

                        const url = window.URL.createObjectURL(blob);

                        const a = document.createElement('a');

                        a.href = url;

                        a.download = `submissions-${new Date().toISOString().split('T')[0]}.csv`;

                        document.body.appendChild(a);

                        a.click();

                        window.URL.revokeObjectURL(url);

                        document.body.removeChild(a);

                        this.showNotification('Export completed successfully', 'success');

                    } else {

                        throw new Error('Export failed');

                    }

                } catch (error) {

                    console.error('Export error:', error);

                    this.showNotification('Export failed: ' + error.message, 'error');

                }

            }



            async logout(message = 'Logged out successfully') {

                try {

                    await this.fetchWithCSRF('/api/admin/logout', {

                        method: 'POST',

                        body: { sessionId: this.sessionId }

                    });

                } catch (error) {

                    console.error('Logout error:', error);

                } finally {

                    this.isAuthenticated = false;

                    this.stopAutoRefresh();

                    if (this.chatSocket) {

                        this.chatSocket.close();

                        this.chatSocket = null;

                    }

                    sessionStorage.removeItem('adminSessionId');

                    this.showLoginForm();

                    this.showNotification(message, 'info');

                }

            }





            showNotification(message, type = 'info', duration = 4000) {

                const container = document.getElementById('notification-container');

                const notification = document.createElement('div');

                notification.className = `notification ${type}`;

                

                notification.innerHTML = `

                    <div class="notification-icon"><i class="fas ${this.getNotificationIcon(type)}"></i></div>

                    <div class="notification-content">${message}</div>

                    <button class="notification-close">&times;</button>

                `;

                

                container.appendChild(notification);

                

                notification.querySelector('.notification-close').addEventListener('click', () => {

                    notification.classList.remove('show');

                    setTimeout(() => {

                        if (container.contains(notification)) {

                            container.removeChild(notification);

                        }

                    }, 400);

                });



                setTimeout(() => notification.classList.add('show'), 10);

                

                setTimeout(() => {

                    notification.classList.remove('show');

                    setTimeout(() => {

                        if (container.contains(notification)) {

                            container.removeChild(notification);

                        }

                    }, 400);

                }, duration);

            }





            getNotificationIcon(type) {

                const icons = {

                    success: 'fa-check-circle',

                    error: 'fa-exclamation-circle',

                    warning: 'fa-exclamation-triangle',

                    info: 'fa-info-circle'

                };

                return icons[type] || icons.info;

            }



            initializeChatSocket() {

                if (this.chatSocket && (this.chatSocket.readyState === WebSocket.OPEN || this.chatSocket.readyState === WebSocket.CONNECTING)) {

                    console.log('WebSocket connection already open or connecting.');

                    return;

                }



                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';

                const wsUrl = `${protocol}//${window.location.host}?endpoint=admin&sessionId=${this.sessionId}`;

                

                try {

                    this.chatSocket = new WebSocket(wsUrl);

                    

                    this.chatSocket.onopen = () => {

                        console.log('WebSocket connected');

                    };

                    

                    this.chatSocket.onclose = () => {

                        console.log('WebSocket disconnected');

                    };

                    

                    this.chatSocket.onerror = (error) => {

                        console.error('WebSocket error:', error);

                    };

                    

                    this.chatSocket.onmessage = (event) => {

                        try {

                            const message = JSON.parse(event.data);

                            this.handleWebSocketMessage(message);

                        } catch (error) {

                            console.error('Error parsing WebSocket message:', error);

                        }

                    };

                } catch (error) {

                    console.error('Error creating WebSocket:', error);

                }

            }



            handleWebSocketMessage(message) {

                switch (message.type) {

                    case 'admin_identified':

                        break;

                    case 'clients':

                        break;

                    case 'chat_history':

                        if (this.selectedChatId === message.clientId) {

                            this.renderChatMessages(message.messages || []);

                        }

                        break;

                    case 'new_message':

                        this.showNotification(`New message from ${message.payload.name}`, 'info');

                        if (this.currentTab === 'chats') {

                            this.loadChats();

                        }

                        break;

                    case 'client_connected':

                        this.showNotification(`Client ${message.payload.name || 'Guest'} connected`, 'info');

                        if (this.currentTab === 'chats') {

                            this.loadChats();

                        }

                        break;

                    case 'client_disconnected':

                         if (this.currentTab === 'chats') {

                            this.loadChats();

                        }

                        break;

                }

            }



            async loadStats() {

                try {

                    const response = await this.fetchWithCSRF('/api/statistics');

                    

                    if (response.ok) {

                        const stats = await response.json();

                        this.stats = stats;

                        this.updateStatsDisplay(stats);

                    } else {

                        throw new Error('Failed to load statistics');

                    }

                } catch (error) {

                    console.error('Error loading stats:', error);

                    this.showNotification('Error loading statistics', 'error');

                }

            }



            updateStatsDisplay(stats) {

                if (document.getElementById('totalSubmissions')) {

                    document.getElementById('totalSubmissions').textContent = stats.total || 0;

                }

                if (document.getElementById('todaySubmissions')) {

                    document.getElementById('todaySubmissions').textContent = stats.today || 0;

                }



                this.loadChatStats();

            }



            async loadChatStats() {

                try {

                    const response = await this.fetchWithCSRF('/api/chat/stats');

                    

                    if (response.ok) {

                        const chatStats = await response.json();

                        if (document.getElementById('activeChats')) {

                            document.getElementById('activeChats').textContent = chatStats.activeChats || 0;

                        }

                    }

                } catch (error) {

                    console.error('Error loading chat stats:', error);

                }

            }



            async loadSubmissions() {

                this.showTableLoading(true);

                

                const params = new URLSearchParams({

                    page: this.currentPage,

                    limit: this.pageSize,

                    search: this.searchTerm,

                    service: this.serviceFilter,

                    date: this.dateFilter,

                    sortField: this.sortField,

                    sortDirection: this.sortDirection

                });



                try {

                    const response = await this.fetchWithCSRF(`/api/submissions?${params.toString()}`);

                    

                    if (response.ok) {

                        const result = await response.json();

                        this.submissions = result.data;

                        this.totalPages = result.pagination.totalPages;

                        this.renderSubmissions();

                        this.updatePaginationControls(result.pagination);

                        this.updateLastRefreshed();

                    } else {

                        throw new Error('Failed to load submissions');

                    }

                } catch (error) {

                    console.error('Error loading submissions:', error);

                    this.showNotification('Error loading submissions', 'error');

                } finally {

                    this.showTableLoading(false);

                }

            }



            async loadBookings() {
                this.showTableLoading(true);
                
                const params = new URLSearchParams({
                    page: this.currentPage || 1,
                    limit: this.pageSize || 10,
                    search: this.searchTerm || '',
                    status: this.statusFilter || '',
                    dateFrom: this.dateFrom || '',
                    dateTo: this.dateTo || ''
                });

                try {
                    const response = await this.fetchWithCSRF(`/api/bookings?${params.toString()}`);
                    
                    if (response.ok) {
                        const result = await response.json();
                        this.bookings = result.data || [];
                        this.totalPages = result.pagination?.totalPages || 1;
                        this.renderBookings();
                        this.updateBookingsStats(result.stats || {});
                        this.updatePaginationControls(result.pagination || {});
                        this.updateLastRefreshed();
                        
                        // Auto-check payment status for pending bookings
                        this.autoCheckPendingPayments();
                    } else {
                        throw new Error('Failed to load bookings');
                    }
                } catch (error) {
                    console.error('Error loading bookings:', error);
                    this.showNotification('Error loading bookings', 'error');
                } finally {
                    this.showTableLoading(false);
                }
            }

            async autoCheckPendingPayments() {
                // Check payment status for pending bookings
                const pendingBookings = this.bookings.filter(b => b.status === 'pending_payment');
                
                for (const booking of pendingBookings) {
                    try {
                        const response = await this.fetchWithCSRF('/api/bookings/check-payment-status', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ bookingId: booking.id })
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            if (result.status === 'updated') {
                                console.log(` Auto-updated booking ${booking.id} to paid`);
                                // Reload bookings to reflect changes
                                this.loadBookings();
                                break; // Only reload once
                            }
                        }
                    } catch (error) {
                        console.warn(`Could not check payment status for booking ${booking.id}:`, error);
                    }
                }
            }

            renderBookings() {
                const tbody = document.querySelector('#bookings-table-body');
                if (!tbody) return;
                
                if (!this.bookings || this.bookings.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><i class="fas fa-calendar-check"></i><p>No bookings found</p></div></td></tr>`;
                    return;
                }

                tbody.innerHTML = this.bookings.map(booking => {
                    const bookingDate = new Date(booking.createdAt).toLocaleDateString();
                    const bookingTime = new Date(booking.createdAt).toLocaleTimeString();
                    const statusClass = booking.status.replace('_', '');
                    const isPaid = booking.status === 'paid' || booking.status === 'confirmed' || booking.status === 'in_progress' || booking.status === 'completed';
                    
                    return `
                        <tr>
                            <td>
                                <div class="booking-id">${this.escapeHtml(booking.id)}</div>
                                <div class="text-sm text-gray-500">${bookingDate} ${bookingTime}</div>
                            </td>
                            <td>
                                <div class="font-medium">${this.escapeHtml(booking.details?.customerName || 'N/A')}</div>
                                <div class="text-sm text-gray-500">${this.escapeHtml(booking.details?.customerEmail || '')}</div>
                            </td>
                            <td>
                                <div class="font-medium">${this.escapeHtml(booking.details?.package || 'N/A')}</div>
                                <div class="text-sm text-gray-500">${booking.details?.duration || 0}h  ${booking.details?.cleaners || 0} cleaners</div>
                            </td>
                            <td>
                                <div class="font-medium">${this.escapeHtml(booking.details?.date || 'N/A')}</div>
                                <div class="text-sm text-gray-500">${this.escapeHtml(booking.details?.time || '')}</div>
                            </td>
                            <td>
                                <div class="font-bold ${isPaid ? 'text-green-600' : booking.status === 'pending_consultation' ? 'text-blue-600' : 'text-gray-500'}">${booking.status === 'pending_consultation' ? 'Quote Required' : '' + (booking.amount || 0)}</div>
                                ${isPaid ? '<div class="text-xs text-green-600"> Paid</div>' : booking.status === 'pending_payment' ? '<div class="text-xs text-yellow-600"> Pending</div>' : booking.status === 'pending_consultation' ? '<div class="text-xs text-blue-600"> Consultation</div>' : ''}
                            </td>
                            <td>
                                <span class="booking-status ${statusClass}">${booking.status.replace('_', ' ')}</span>
                            </td>
                            <td>
                                <div class="booking-actions">
                                    <button class="btn btn-sm btn-primary" onclick="adminPanel.viewBooking('${booking.id}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="adminPanel.editBookingStatus('${booking.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    ${booking.status === 'pending_payment' ? `
                                        <button class="btn btn-sm btn-accent" onclick="adminPanel.checkPaymentStatus('${booking.id}')" title="Check Payment Status">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            updateBookingsStats(stats) {
                document.getElementById('total-bookings').textContent = stats.total || 0;
                document.getElementById('total-revenue').textContent = `${stats.revenue || 0}`;
                document.getElementById('pending-bookings').textContent = stats.pending || 0;
                document.getElementById('completed-bookings').textContent = stats.completed || 0;
            }

            async viewBooking(bookingId) {
                try {
                    const response = await this.fetchWithCSRF(`/api/bookings/${bookingId}`);
                    if (response.ok) {
                        const booking = await response.json();
                        this.showBookingModal(booking);
                    } else {
                        this.showNotification('Failed to load booking details', 'error');
                    }
                } catch (error) {
                    console.error('Error viewing booking:', error);
                    this.showNotification('Error loading booking details', 'error');
                }
            }

            showBookingModal(booking) {
                // Create and show booking details modal
                const modal = document.createElement('div');
                modal.className = 'modal';
                // Add inline styles to ensure visibility
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    padding: 20px;
                `;
                
                // Check if booking is paid and has payment details
                const isPaid = booking.status === 'paid' || booking.status === 'confirmed' || booking.status === 'in_progress' || booking.status === 'completed';
                const hasPaymentDetails = booking.paymentIntentId || booking.paidAt;
                
                // Extract booking details with fallbacks
                const details = booking.details || {};
                const customerName = details.customerName || 'N/A';
                const customerEmail = details.customerEmail || 'N/A';
                const customerPhone = details.customerPhone || 'N/A';
                const customerAddress = details.customerAddress || 'N/A';
                const city = details.city || 'N/A';
                const postalCode = details.postalCode || 'N/A';
                const specialRequests = details.specialRequests || 'No special requests';
                const salutation = details.salutation || 'N/A';
                const packageType = details.package || 'N/A';
                const date = details.date || 'N/A';
                const time = details.time || 'N/A';
                const duration = details.duration || 0;
                const cleaners = details.cleaners || 0;
                const propertySize = details.propertySize || 'N/A';

                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 900px; background: white; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); width: 100%; max-height: 90vh; display: flex; flex-direction: column; overflow: hidden;">
                        <div class="modal-header" style="padding: 24px 32px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <h3 style="margin: 0; font-size: 1.5rem; font-weight: 700; color: white;">Booking Details - ${booking.id}</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()" style="background: rgba(255, 255, 255, 0.2); border: none; font-size: 1.5rem; cursor: pointer; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">&times;</button>
                        </div>
                        <div class="modal-body" style="max-height: 70vh; overflow-y: auto; padding: 32px; flex: 1; background: #f8fafc;">
                            <div class="booking-details">
                                <!-- Booking Information -->
                                <div class="detail-group" style="margin-bottom: 24px; padding: 24px; background: white; border-radius: 12px; border-left: 4px solid #3b82f6; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                    <h4 style="color: #1f2937; font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #f3f4f6; padding-bottom: 12px;"><i class="fas fa-info-circle" style="color: #3b82f6;"></i> Booking Information</h4>
                                    <div class="grid grid-cols-2 gap-4" style="display: grid; gap: 20px; grid-template-columns: 1fr 1fr;">
                                        <div>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Booking ID:</strong> <span style="font-family: 'Monaco', 'Menlo', monospace; background: #f1f5f9; padding: 2px 8px; border-radius: 4px; font-size: 0.85rem;">${this.escapeHtml(booking.id)}</span></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Status:</strong> <span class="booking-status ${booking.status.replace('_', '')}" style="padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">${booking.status.replace('_', ' ')}</span></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Amount:</strong> <span style="color: #059669; font-weight: 700; font-size: 1.1rem;">${booking.amount || 0}</span></p>
                                        </div>
                                        <div>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Created:</strong> <span style="color: #6b7280;">${new Date(booking.createdAt).toLocaleString()}</span></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Updated:</strong> <span style="color: #6b7280;">${booking.updatedAt ? new Date(booking.updatedAt).toLocaleString() : 'N/A'}</span></p>
                                            ${isPaid && hasPaymentDetails ? `
                                                <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Paid At:</strong> <span style="color: #059669; font-weight: 600;">${booking.paidAt ? new Date(booking.paidAt).toLocaleString() : 'N/A'}</span></p>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>

                                <!-- Customer Information -->
                                <div class="detail-group" style="margin-bottom: 24px; padding: 24px; background: white; border-radius: 12px; border-left: 4px solid #10b981; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                    <h4 style="color: #1f2937; font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #f3f4f6; padding-bottom: 12px;"><i class="fas fa-user" style="color: #10b981;"></i> Customer Information</h4>
                                    <div class="grid grid-cols-2 gap-4" style="display: grid; gap: 20px; grid-template-columns: 1fr 1fr;">
                                        <div>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Salutation:</strong> <span style="color: #6b7280;">${this.escapeHtml(salutation)}</span></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Name:</strong> <span style="color: #1f2937; font-weight: 600;">${this.escapeHtml(customerName)}</span></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Email:</strong> <a href="mailto:${this.escapeHtml(customerEmail)}" style="color: #3b82f6; text-decoration: none; font-weight: 500; padding: 2px 8px; background: #eff6ff; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='#eff6ff'">${this.escapeHtml(customerEmail)}</a></p>
                                        </div>
                                        <div>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Phone:</strong> <a href="tel:${this.escapeHtml(customerPhone)}" style="color: #3b82f6; text-decoration: none; font-weight: 500; padding: 2px 8px; background: #eff6ff; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='#eff6ff'">${this.escapeHtml(customerPhone)}</a></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Address:</strong> <span style="color: #6b7280;">${this.escapeHtml(customerAddress)}</span></p>
                                            <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">City & Postal:</strong> <span style="color: #6b7280;">${this.escapeHtml(city)}, ${this.escapeHtml(postalCode)}</span></p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Service Details -->
                                <div class="detail-group" style="margin-bottom: 24px; padding: 24px; background: white; border-radius: 12px; border-left: 4px solid #f59e0b; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                    <h4 style="color: #1f2937; font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #f3f4f6; padding-bottom: 12px;"><i class="fas fa-concierge-bell" style="color: #f59e0b;"></i> Service Details</h4>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <p><strong>Package:</strong> ${this.escapeHtml(packageType)}</p>
                                            <p><strong>Date:</strong> ${this.escapeHtml(date)}</p>
                                            <p><strong>Time:</strong> ${this.escapeHtml(time)}</p>
                                        </div>
                                        <div>
                                            <p><strong>Duration:</strong> ${duration} hours</p>
                                            <p><strong>Cleaners:</strong> ${cleaners}</p>
                                            <p><strong>Property Size:</strong> ${propertySize} m</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Special Requests -->
                                <div class="detail-group" style="margin-bottom: 24px; padding: 24px; background: white; border-radius: 12px; border-left: 4px solid #8b5cf6; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                    <h4 style="color: #1f2937; font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #f3f4f6; padding-bottom: 12px;"><i class="fas fa-comment-dots" style="color: #8b5cf6;"></i> Special Requests & Messages</h4>
                                    <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06); max-height: 200px; overflow-y: auto; word-wrap: break-word; overflow-wrap: break-word;">
                                        <p style="white-space: pre-wrap; color: #374151; font-size: 0.95rem; line-height: 1.7; margin: 0; font-style: italic; word-break: break-word; overflow-wrap: break-word; hyphens: auto;">${this.escapeHtml(specialRequests)}</p>
                                    </div>
                                </div>

                           <!-- Payment Information -->
                           ${booking.status === 'pending_consultation' ? `
                               <div class="detail-group" style="margin-bottom: 24px; padding: 24px; background: white; border-radius: 12px; border-left: 4px solid #3b82f6; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                   <h4 style="color: #1f2937; font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #f3f4f6; padding-bottom: 12px;"><i class="fas fa-phone" style="color: #3b82f6;"></i> Commercial Consultation Required</h4>
                                   <p style="margin: 12px 0; color: #4b5563; font-size: 0.95rem; line-height: 1.6;"><strong style="color: #374151; font-weight: 600; display: inline-block; min-width: 120px;">Status:</strong> <span style="color: #3b82f6; font-weight: 700;"> Pending Consultation</span></p>
                                   <p style="margin: 8px 0; color: #6b7280; font-size: 0.85rem; line-height: 1.5; margin-top: 10px;">This is a commercial cleaning request. Please contact the customer to discuss their specific needs and provide a custom quote.</p>
                               </div>
                           ` : isPaid && hasPaymentDetails ? `
                                    <div class="detail-group">
                                        <h4><i class="fas fa-credit-card"></i> Payment Information</h4>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <p><strong>Payment Status:</strong> <span class="text-green-600 font-semibold"> Successfully Paid</span></p>
                                                <p><strong>Payment Method:</strong> Stripe Payment</p>
                                            </div>
                                            <div>
                                                <p><strong>Transaction ID:</strong> <code class="text-sm">${this.escapeHtml(booking.paymentIntentId || 'N/A')}</code></p>
                                                <p><strong>Payment Date:</strong> ${booking.paidAt ? new Date(booking.paidAt).toLocaleString() : 'N/A'}</p>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <p><strong>Amount Paid:</strong> <span class="text-green-600 font-bold text-lg">${booking.amount || 0}</span></p>
                                        </div>
                                    </div>
                                ` : booking.status === 'pending_payment' ? `
                                    <div class="detail-group">
                                        <h4><i class="fas fa-credit-card"></i> Payment Information</h4>
                                        <p><strong>Payment Status:</strong> <span class="text-yellow-600 font-semibold"> Pending Payment</span></p>
                                        <p class="text-sm text-gray-600 mt-2">Payment has not been completed yet. This booking will not be included in revenue calculations until payment is successful.</p>
                                    </div>
                                ` : booking.status === 'payment_failed' ? `
                                    <div class="detail-group">
                                        <h4><i class="fas fa-credit-card"></i> Payment Information</h4>
                                        <p><strong>Payment Status:</strong> <span class="text-red-600 font-semibold"> Payment Failed</span></p>
                                        <p><strong>Error:</strong> ${this.escapeHtml(booking.paymentError || 'Payment failed')}</p>
                                        <p><strong>Failed At:</strong> ${booking.failedAt ? new Date(booking.failedAt).toLocaleString() : 'N/A'}</p>
                                    </div>
                                ` : ''}

                                <!-- Quick Actions -->
                                <div class="detail-group" style="margin-bottom: 24px; padding: 24px; background: white; border-radius: 12px; border-left: 4px solid #06b6d4; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                    <h4 style="color: #1f2937; font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #f3f4f6; padding-bottom: 12px;"><i class="fas fa-bolt" style="color: #06b6d4;"></i> Quick Actions</h4>
                                    <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                                        <button onclick="adminPanel.sendEmailToCustomer('${customerEmail}', '${customerName}')" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3); display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px -3px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(59, 130, 246, 0.3)'">
                                            <i class="fas fa-envelope"></i> Email Customer
                                        </button>
                                        <button onclick="adminPanel.callCustomer('${customerPhone}')" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3); display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px -3px rgba(16, 185, 129, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(16, 185, 129, 0.3)'">
                                            <i class="fas fa-phone"></i> Call Customer
                                        </button>
                                        <button onclick="adminPanel.copyCustomerDetails('${customerName}', '${customerEmail}', '${customerPhone}', '${customerAddress}')" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(107, 114, 128, 0.3); display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px -3px rgba(107, 114, 128, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(107, 114, 128, 0.3)'">
                                            <i class="fas fa-copy"></i> Copy Details
                                        </button>
                                        ${booking.status === 'pending_payment' ? `
                                            <button onclick="adminPanel.checkPaymentStatus('${booking.id}')" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.3); display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px -3px rgba(245, 158, 11, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(245, 158, 11, 0.3)'">
                                                <i class="fas fa-sync-alt"></i> Check Payment
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" style="padding: 24px 32px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 16px; background: #f8fafc;">
                            <button onclick="this.closest('.modal').remove()" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(107, 114, 128, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px -3px rgba(107, 114, 128, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(107, 114, 128, 0.3)'">Close</button>
                            <button onclick="adminPanel.printBookingDetails('${booking.id}')" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3); display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px -3px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(59, 130, 246, 0.3)'">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // Send email to customer
            sendEmailToCustomer(email, name) {
                const subject = encodeURIComponent(`Regarding your cleaning booking - AJK Cleaning`);
                const body = encodeURIComponent(`Dear ${name},\n\n`);
                window.open(`mailto:${email}?subject=${subject}&body=${body}`, '_blank');
            }

            // Call customer
            callCustomer(phone) {
                if (phone && phone !== 'N/A') {
                    window.open(`tel:${phone}`, '_blank');
                } else {
                    this.showNotification('No phone number available for this customer', 'warning');
                }
            }

            // Copy customer details to clipboard
            async copyCustomerDetails(name, email, phone, address) {
                const details = `Customer Details:\nName: ${name}\nEmail: ${email}\nPhone: ${phone}\nAddress: ${address}`;
                
                try {
                    await navigator.clipboard.writeText(details);
                    this.showNotification('Customer details copied to clipboard!', 'success');
                } catch (err) {
                    console.error('Failed to copy details: ', err);
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = details;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    this.showNotification('Customer details copied to clipboard!', 'success');
                }
            }

            // Print booking details
            printBookingDetails(bookingId) {
                const modal = document.querySelector('.modal');
                if (modal) {
                    const printContent = modal.querySelector('.modal-content').innerHTML;
                    const originalContent = document.body.innerHTML;
                    
                    document.body.innerHTML = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>Booking Details - ${bookingId}</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                .detail-group { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
                                .detail-group h4 { margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; }
                                .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                                .booking-status { padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
                                .text-green-600 { color: #059669; }
                                .text-yellow-600 { color: #d97706; }
                                .text-red-600 { color: #dc2626; }
                                @media print {
                                    .modal-footer { display: none; }
                                }
                            </style>
                        </head>
                        <body>
                            ${printContent}
                        </body>
                        </html>
                    `;
                    
                    window.print();
                    document.body.innerHTML = originalContent;
                    this.showNotification('Print dialog opened', 'info');
                }
            }

            async editBookingStatus(bookingId) {
                // Simple status update functionality
                const newStatus = prompt('Enter new status (pending_payment, paid, confirmed, in_progress, completed, payment_failed, cancelled):');
                if (newStatus && ['pending_payment', 'paid', 'confirmed', 'in_progress', 'completed', 'payment_failed', 'cancelled'].includes(newStatus)) {
                    try {
                        const response = await this.fetchWithCSRF(`/api/bookings/${bookingId}/status`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ status: newStatus })
                        });
                        
                        if (response.ok) {
                            this.showNotification('Booking status updated successfully', 'success');
                            this.loadBookings();
                        } else {
                            this.showNotification('Failed to update booking status', 'error');
                        }
                    } catch (error) {
                        console.error('Error updating booking status:', error);
                        this.showNotification('Error updating booking status', 'error');
                    }
                }
            }

            async exportBookings() {
                try {
                    const response = await this.fetchWithCSRF('/api/bookings/export');
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `bookings-export-${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        this.showNotification('Bookings exported successfully', 'success');
                    } else {
                        this.showNotification('Failed to export bookings', 'error');
                    }
                } catch (error) {
                    console.error('Error exporting bookings:', error);
                    this.showNotification('Error exporting bookings', 'error');
                }
            }

            async checkPaymentStatus(bookingId) {
                try {
                    const response = await this.fetchWithCSRF('/api/bookings/check-payment-status', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ bookingId })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        this.showNotification(result.message, 'success');
                        this.loadBookings(); // Refresh the bookings list
                    } else {
                        const error = await response.json();
                        this.showNotification(error.error || 'Failed to check payment status', 'error');
                    }
                } catch (error) {
                    console.error('Error checking payment status:', error);
                    this.showNotification('Error checking payment status', 'error');
                }
            }



            showTableLoading(show) {

                const loadingOverlay = document.getElementById('table-loading');

                if (loadingOverlay) {

                    loadingOverlay.style.display = show ? 'flex' : 'none';

                }

            }



            renderSubmissions() {

                const tbody = document.querySelector('#submissionsTable tbody');

                if (!tbody) return;

                

                if (!this.submissions || this.submissions.length === 0) {

                    tbody.innerHTML = `<tr><td colspan="10"><div class="empty-state"><i class="fas fa-file-alt"></i><p>No submissions found</p></div></td></tr>`;

                    return;

                }

                

                tbody.innerHTML = '';

                const isMobile = this.detectDeviceType() === 'Mobile';



                this.submissions.forEach(submission => {

                    const row = document.createElement('tr');

                    const date = new Date(submission.submitted_at).toLocaleDateString();



                    if (isMobile) {

                        // Mobile Card View - similar to chat view

                        row.innerHTML = `

                            <td colspan="10">

                                <div class="submission-card-mobile">

                                    <div class="card-header-mobile">

                                        <div>

                                            <h4>${this.escapeHtml(submission.name)}</h4>

                                            <div class="submission-details-mobile" style="grid-template-columns: 1fr; gap: 4px;">

                                                <span><i class="fas fa-phone"></i> ${this.escapeHtml(submission.phone || '-')}</span>

                                            </div>

                                        </div>

                                        <div style="text-align: right;">

                                            <span class="submission-id">#${submission.id}</span>

                                            <input type="checkbox" class="submission-checkbox" data-id="${submission.id}" style="margin-top: 8px; transform: scale(1.5);">

                                        </div>

                                    </div>

                                    <div class="submission-details-mobile">

                                         <span><i class="fas fa-concierge-bell"></i> ${this.escapeHtml(submission.service || '-')}</span>

                                         <span><i class="fas fa-calendar-alt"></i> ${date}</span>

                                    </div>

                                    <div class="submission-actions">

                                        <button type="button" class="btn btn-primary btn-sm view-btn" data-id="${submission.id}"><i class="fas fa-eye"></i> View</button>

                                        <button type="button" class="btn btn-danger btn-sm delete-btn-sm" data-id="${submission.id}"><i class="fas fa-trash"></i> Delete</button>

                                    </div>

                                </div>

                            </td>

                        `;

                    } else {

                        // Desktop Table View

                        row.innerHTML = `

                            <td><input type="checkbox" class="submission-checkbox" data-id="${submission.id}"></td>

                            <td>${submission.id}</td>

                            <td>${this.escapeHtml(submission.name)}</td>

                            <td>${this.escapeHtml(submission.email)}</td>

                            <td>${this.escapeHtml(submission.phone || '-')}</td>

                            <td>${this.escapeHtml(submission.service || '-')}</td>

                            <td>${this.escapeHtml(submission.preferred_date || '-')}</td>

                            <td>${this.escapeHtml(submission.preferred_time || '-')}</td>

                            <td>${date}</td>

                            <td>

                                <div class="mobile-actions">

                                    <button type="button" class="action-btn view-btn" data-id="${submission.id}">View</button>

                                    <button type="button" class="action-btn delete-btn-sm" data-id="${submission.id}">Delete</button>

                                </div>

                            </td>

                        `;

                    }

                    tbody.appendChild(row);

                });

                

                this.setupSubmissionEventListeners();

            }

            

            updatePaginationControls(pagination) {

                if (document.getElementById('page-info')) {

                    document.getElementById('page-info').textContent = `Page ${pagination.page} of ${pagination.totalPages || 1}`;

                }

                if (document.getElementById('prev-page')) {

                    document.getElementById('prev-page').disabled = !pagination.hasPrev;

                }

                if (document.getElementById('next-page')) {

                    document.getElementById('next-page').disabled = !pagination.hasNext;

                }

            }



            escapeHtml(unsafe) {

                if (unsafe === null || unsafe === undefined) return '';

                const s = String(unsafe);

                return s

                     .replace(/&/g, "&amp;")

                     .replace(/</g, "&lt;")

                     .replace(/>/g, "&gt;")

                     .replace(/"/g, "&quot;")

                     .replace(/'/g, "&#039;");

            }



            setupSubmissionEventListeners() {

                document.querySelectorAll('.view-btn').forEach(btn => {

                    btn.addEventListener('click', () => this.viewSubmission(btn.getAttribute('data-id')));

                });

                document.querySelectorAll('.delete-btn-sm').forEach(btn => {

                    btn.addEventListener('click', () => this.deleteSubmission(btn.getAttribute('data-id')));

                });

                document.querySelectorAll('.submission-checkbox').forEach(checkbox => {

                    checkbox.addEventListener('change', () => this.updateBulkDeleteButton());

                });

            }



            async viewSubmission(id) {

                try {

                    const response = await this.fetchWithCSRF(`/api/submissions/${id}`);

                    

                    if (response.ok) {

                        const submission = await response.json();

                        this.showSubmissionDetails(submission);

                    } else {

                        throw new Error('Failed to load submission details');

                    }

                } catch (error) {

                    console.error('Error viewing submission:', error);

                    this.showNotification('Error loading submission details', 'error');

                }

            }



            showSubmissionDetails(submission) {

                const detailView = document.getElementById('detailView');

                if (!detailView) return;

                

                document.getElementById('detail-id').textContent = submission.id;

                document.getElementById('detail-name').textContent = submission.name;

                document.getElementById('detail-email').textContent = submission.email;

                document.getElementById('detail-phone').textContent = submission.phone || '-';

                document.getElementById('detail-service').textContent = submission.service || '-';

                document.getElementById('detail-preferred-date').textContent = submission.preferred_date || '-';

                document.getElementById('detail-preferred-time').textContent = submission.preferred_time || '-';

                document.getElementById('detail-message').textContent = submission.message;

                document.getElementById('detail-date').textContent = new Date(submission.submitted_at).toLocaleString();

                

                detailView.style.display = 'block';

            }



            async deleteSubmission(id) {

                if (!confirm('Are you sure you want to delete this submission?')) return;

                

                try {

                    const response = await this.fetchWithCSRF(`/api/submissions/${id}`, { method: 'DELETE' });

                    

                    if (response.ok) {

                        this.loadSubmissions(); // Reload data from server

                        this.showNotification('Submission deleted successfully', 'success');

                    } else {

                        throw new Error('Failed to delete submission');

                    }

                } catch (error) {

                    console.error('Error deleting submission:', error);

                    this.showNotification('Error deleting submission', 'error');

                }

            }



            updateBulkDeleteButton() {

                const selectedCount = document.querySelectorAll('.submission-checkbox:checked').length;

                const bulkDeleteBtn = document.getElementById('bulk-delete-btn');

                if (bulkDeleteBtn) {

                    bulkDeleteBtn.disabled = selectedCount === 0;

                }

            }



            async handleBulkDelete() {

                const selectedIds = Array.from(document.querySelectorAll('.submission-checkbox:checked'))

                    .map(cb => parseInt(cb.dataset.id, 10));

                    

                if (selectedIds.length === 0) return;

                

                if (!confirm(`Are you sure you want to delete ${selectedIds.length} submissions?`)) return;



                try {

                    const response = await this.fetchWithCSRF('/api/submissions/bulk-delete', {

                        method: 'POST',

                        body: { ids: selectedIds }

                    });

                    

                    if (response.ok) {

                        const result = await response.json();

                        this.loadSubmissions(); // Reload data from server

                        this.showNotification(`${result.deleted} submissions deleted successfully`, 'success');

                    } else {

                        const errorResult = await response.json().catch(() => ({ error: 'Failed to delete submissions.' }));

                        throw new Error(errorResult.error || 'Failed to delete submissions.');

                    }

                } catch (error) {

                    console.error('Error in bulk delete:', error);

                    this.showNotification(error.message, 'error');

                }

            }



            async loadChats() {

                try {

                    const response = await this.fetchWithCSRF('/api/chats');

                    

                    if (response.ok) {

                        this.chats = await response.json();

                        this.filterChats();

                    } else {

                        throw new Error('Failed to load chats');

                    }

                } catch (error) {

                    console.error('Error loading chats:', error);

                    this.showNotification('Error loading chats', 'error');

                }

            }

            

            filterChats() {

                const searchTerm = document.getElementById('chat-search-management')?.value.toLowerCase() || '';

                const filterValue = document.getElementById('chat-filter')?.value || 'all';

                const sortValue = document.getElementById('chat-sort')?.value || 'newest';

                

                let filtered = Object.entries(this.chats).filter(([clientId, chat]) => {

                    if (!chat || chat.deleted) return false;

                    

                    if (filterValue !== 'all') {

                        const status = chat.status || 'active';

                        if (status !== filterValue) return false;

                    }

                    

                    if (searchTerm) {

                        const name = (chat.clientInfo?.name || '').toLowerCase();

                        const email = (chat.clientInfo?.email || '').toLowerCase();

                        return name.includes(searchTerm) || email.includes(searchTerm);

                    }

                    

                    return true;

                });

                

                filtered.sort((a, b) => {

                    const chatA = a[1];

                    const chatB = b[1];

                    

                    switch (sortValue) {

                        case 'oldest':

                            return new Date(chatA.clientInfo?.firstSeen || 0) - new Date(chatB.clientInfo?.firstSeen || 0);

                        case 'most-active':

                            return (chatB.messages?.length || 0) - (chatA.messages?.length || 0);

                        case 'newest':

                        default:

                            return new Date(chatB.clientInfo?.firstSeen || 0) - new Date(chatA.clientInfo?.firstSeen || 0);

                    }

                });



                this.filteredChats = filtered;

                this.renderChats();

            }



            renderChats() {

                const chatsList = document.getElementById('chats-list');

                if (!chatsList) return;

                

                if (this.filteredChats.length === 0) {

                    chatsList.innerHTML = `<div class="empty-state"><i class="fas fa-comments"></i><p>No chats found</p></div>`;

                    return;

                }

                

                let html = '';

                

                this.filteredChats.forEach(([clientId, chat]) => {

                    const clientInfo = chat.clientInfo || {};

                    const status = chat.status || 'active';

                    const messageCount = chat.messages?.length || 0;

                    const lastMessage = messageCount > 0 ? chat.messages[messageCount - 1] : null;

                    const lastMessageTime = lastMessage ? new Date(lastMessage.timestamp).toLocaleString() : 'No messages';

                    

                    html += `

                        <div class="chat-item ${status}">

                            <div class="chat-info">

                                <span class="chat-status status-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>

                                <h4>${this.escapeHtml(clientInfo.name || 'Anonymous')}</h4>

                                <p>${this.escapeHtml(clientInfo.email || 'No email')}</p>

                                <small>First seen: ${clientInfo.firstSeen ? this.formatDate(clientInfo.firstSeen) : 'Unknown'}</small>

                                <small>Messages: ${messageCount}</small>

                                <small>Last activity: ${lastMessageTime}</small>

                            </div>

                            <div class="chat-actions">

                                <button type="button" class="btn-view" data-client-id="${clientId}">View</button>

                                ${status !== 'resolved' ? 

                                    `<button type="button" class="btn-resolve" data-client-id="${clientId}">Resolve</button>` : 

                                    ''

                                }

                                <button type="button" class="btn-delete" data-client-id="${clientId}">Delete</button>

                            </div>

                        </div>

                    `;

                });

                

                chatsList.innerHTML = html;

                

                document.querySelectorAll('.btn-view').forEach(btn => {

                    btn.addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        this.viewChat(btn.getAttribute('data-client-id'));

                    });

                });

                document.querySelectorAll('.btn-resolve').forEach(btn => {

                    btn.addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        this.resolveChat(btn.getAttribute('data-client-id'));

                    });

                });

                document.querySelectorAll('.btn-delete').forEach(btn => {

                    btn.addEventListener('click', (e) => {

                        e.preventDefault();

                        e.stopPropagation();

                        this.deleteChat(btn.getAttribute('data-client-id'));

                    });

                });

            }



            formatDate(dateString) {

                if (!dateString) return 'Unknown';

                const date = new Date(dateString);

                if (isNaN(date.getTime())) return 'Unknown';

                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();

            }

            

            async viewChat(clientId) {

                this.selectedChatId = clientId;

                

                const modal = document.getElementById('chat-ticket-modal');

                const messagesContainer = document.getElementById('ticket-messages');

                

                if (!modal || !messagesContainer) {

                    return;

                }



                try {

                    messagesContainer.innerHTML = '<div class="modal-loading"><div class="spinner"></div></div>';

                    modal.style.display = 'block';

                    

                    const response = await this.fetchWithCSRF(`/api/chats/${clientId}`);

                    

                    if (response.ok) {

                        const chat = await response.json();

                        

                        document.getElementById('ticket-client-name').textContent = chat.clientInfo?.name || 'Anonymous';

                        document.getElementById('ticket-client-email').textContent = chat.clientInfo?.email || 'No email';

                        

                        const status = chat.status || 'active';

                        const statusElement = document.getElementById('ticket-status');

                        if (statusElement) {

                            statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);

                            statusElement.className = `chat-status status-${status}`;

                        }

                        

                        const historyResponse = await this.fetchWithCSRF(`/api/chat/history/${clientId}`);

                        

                        if (historyResponse.ok) {

                            const messages = await historyResponse.json();

                            this.renderChatMessages(messages);

                        } else {

                            throw new Error('Failed to load chat history');

                        }

                    } else {

                        throw new Error('Failed to load chat details');

                    }

                } catch (error) {

                    console.error('Error in viewChat:', error);

                    messagesContainer.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i> Error loading chat</div>';

                    this.showNotification('Error loading chat details', 'error');

                }

            }



            renderChatMessages(messages) {

                const container = document.getElementById('ticket-messages');

                if (!container) return;

                

                if (!messages || messages.length === 0) {

                    container.innerHTML = '<div class="empty-state">No messages yet. Start the conversation!</div>';

                    return;

                }

                

                try {

                    const sortedMessages = [...messages].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

                    container.innerHTML = '';

                    sortedMessages.forEach(message => this.addMessageToUI(message));

                    container.scrollTop = container.scrollHeight;

                } catch (error) {

                    container.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i> Error displaying messages</div>';

                }

            }

            

            addMessageToUI(message) {

                const container = document.getElementById('ticket-messages');

                if (!container) return;

                

                const messageDiv = document.createElement('div');

                messageDiv.className = `message ${message.isAdmin ? 'admin' : 'client'}`;

                messageDiv.setAttribute('data-message-id', message.id);

                

                const time = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                

                messageDiv.innerHTML = `

                    <div class="message-avatar">

                        <i class="fas ${message.isAdmin ? 'fa-user-shield' : 'fa-user'}"></i>

                    </div>

                    <div class="message-bubble">

                        <div class="message-text">${this.escapeHtml(message.message || '')}</div>

                        <div class="message-info">

                            <span class="message-time">${time}</span>

                            ${message.isAdmin ? '<span class="message-status"><i class="fas fa-check"></i> Sent</span>' : ''}

                        </div>

                    </div>

                `;

                

                const emptyState = container.querySelector('.empty-state');

                if (emptyState) emptyState.remove();



                container.appendChild(messageDiv);

                

                container.scrollTop = container.scrollHeight;

            }

            

            async sendTicketReply() {

                const input = document.getElementById('ticket-reply-input');

                const message = input.value.trim();

                

                if (!message || !this.selectedChatId) {

                    this.showNotification('Please enter a message', 'warning');

                    return;

                }

                

                const sendButton = document.getElementById('ticket-send-reply');

                const originalButtonHTML = sendButton.innerHTML;

                

                const tempId = `temp_${Date.now()}`;

                const optimisticMessage = {

                    id: tempId,

                    message: message,

                    isAdmin: true,

                    timestamp: new Date().toISOString()

                };

                

                this.addMessageToUI(optimisticMessage);

                input.value = '';

                

                sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

                sendButton.disabled = true;

                input.disabled = true;

                

                try {

                    const response = await this.fetchWithCSRF('/api/chat/send', {

                        method: 'POST',

                        body: {

                            clientId: this.selectedChatId,

                            message: message

                        }

                    });

                

                    if (!response.ok) {

                        const messageEl = document.querySelector(`[data-message-id="${tempId}"]`);

                        if (messageEl) messageEl.remove();

                        throw new Error('Failed to send message');

                    }

                

                    this.showNotification('Message sent successfully', 'success');

                } catch (error) {

                    console.error('Error sending message:', error);

                    this.showNotification('Failed to send message: ' + error.message, 'error');

                    const messageEl = document.querySelector(`[data-message-id="${tempId}"]`);

                    if (messageEl) messageEl.remove();

                } finally {

                    sendButton.innerHTML = originalButtonHTML;

                    sendButton.disabled = false;

                    input.disabled = false;

                    input.focus();

                }

            }



            async resolveTicket() {

                if (!this.selectedChatId) return;

                

                try {

                    const response = await this.fetchWithCSRF(`/api/chats/resolve/${this.selectedChatId}`, { method: 'POST' });

                    

                    if (response.ok) {

                        this.showNotification('Chat resolved successfully', 'success');

                        document.getElementById('chat-ticket-modal').style.display = 'none';

                        this.loadChats();

                    } else {

                        throw new Error('Failed to resolve chat');

                    }

                } catch (error) {

                    console.error('Error resolving chat:', error);

                    this.showNotification('Error resolving chat', 'error');

                }

            }



            async resolveChat(clientId) {

                if (!confirm('Are you sure you want to mark this chat as resolved?')) return;

                

                try {

                    const response = await this.fetchWithCSRF(`/api/chats/resolve/${clientId}`, { method: 'POST' });

                    

                    if (response.ok) {

                        this.showNotification('Chat resolved successfully', 'success');

                        this.loadChats();

                    } else {

                        throw new Error('Failed to resolve chat');

                    }

                } catch (error) {

                    console.error('Error resolving chat:', error);

                    this.showNotification('Error resolving chat', 'error');

                }

            }

            

            async deleteChat(clientId) {

                if (!confirm('Are you sure you want to delete this chat? This will reset the user back to AI assistant and cannot be undone.')) {

                    return;

                }

                

                try {

                    const response = await this.fetchWithCSRF(`/api/chats/${clientId}`, { method: 'DELETE' });

                    

                    if (response.ok) {

                        this.showNotification('Chat deleted successfully. User has been reset to AI assistant.', 'success');

                        

                        if (this.selectedChatId === clientId) {

                            document.getElementById('chat-ticket-modal').style.display = 'none';

                            this.selectedChatId = null;

                        }

                        

                        this.loadChats();

                    } else {

                        throw new Error('Failed to delete chat');

                    }

                } catch (error) {

                    console.error('Error deleting chat:', error);

                    this.showNotification('Error deleting chat. Please try again.', 'error');

                }

            }



            saveSetting(id, value) {

                const settings = JSON.parse(localStorage.getItem('adminSettings') || '{}');

                settings[id] = value;

                localStorage.setItem('adminSettings', JSON.stringify(settings));

                

                this.applySetting(id, value);

            }



            applySetting(id, value) {

                switch(id) {

                    case 'dark-mode':

                        this.setTheme(value ? 'dark' : 'light');

                        break;

                    case 'compact-view':

                        document.body.classList.toggle('compact-view', value);

                        break;

                    case 'animations':

                        document.body.classList.toggle('animations-enabled', value);

                        break;

                    case 'desktop-notifications':

                        if (value) {

                            this.requestNotificationPermission();

                        }

                        break;

                }

            }



            async requestNotificationPermission() {

                if ('Notification' in window) {

                    try {

                        const permission = await Notification.requestPermission();

                        if (permission === 'granted') {

                            this.showNotification("Desktop notifications enabled!", "success");

                        } else {

                            this.showNotification("Desktop notifications were denied.", "warning");

                        }

                    } catch (error) {

                        console.error('Error requesting notification permission:', error);

                    }

                }

            }



            loadSettings() {

                const settings = JSON.parse(localStorage.getItem('adminSettings') || '{}');

                

                Object.entries(settings).forEach(([key, value]) => {

                    const checkbox = document.getElementById(key);

                    if (checkbox) {

                        checkbox.checked = value;

                        this.applySetting(key, value);

                    }

                });

            }



            async createBackup() {

                try {

                    const response = await this.fetchWithCSRF('/api/admin/backup');

                    

                    if (response.ok) {

                        const result = await response.json();

                        this.showNotification(`Backup created: ${result.file}`, 'success');

                    } else {

                        throw new Error('Backup failed');

                    }

                } catch (error) {

                    console.error('Backup error:', error);

                    this.showNotification('Backup failed: ' + error.message, 'error');

                }

            }



            initializeCharts() {

                // Dashboard Charts

                const serviceCtx = document.getElementById('serviceChart');

                if (serviceCtx) {

                    new Chart(serviceCtx, {

                        type: 'doughnut',

                        data: {

                            labels: ['Residential', 'Commercial', 'Deep Cleaning', 'Move In/Out'],

                            datasets: [{

                                data: [45, 25, 20, 10],

                                backgroundColor: ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981'],

                                borderWidth: 0

                            }]

                        },

                        options: {

                            responsive: true,

                            maintainAspectRatio: false,

                            plugins: {

                                legend: { position: 'bottom', labels: { padding: 20, usePointStyle: true } }

                            }

                        }

                    });

                }



                const timelineCtx = document.getElementById('timelineChart');

                if (timelineCtx) {

                    new Chart(timelineCtx, {

                        type: 'line',

                        data: {

                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],

                            datasets: [{

                                label: 'Submissions',

                                data: [12, 19, 8, 15, 12, 10, 14],

                                borderColor: '#6366f1',

                                backgroundColor: 'rgba(99, 102, 241, 0.1)',

                                borderWidth: 3,

                                fill: true,

                                tension: 0.4,

                                pointBackgroundColor: '#6366f1',

                                pointBorderColor: '#ffffff',

                                pointBorderWidth: 2,

                                pointRadius: 6

                            }]

                        },

                        options: {

                            responsive: true,

                            maintainAspectRatio: false,

                            plugins: { legend: { display: false } },

                            scales: {

                                y: { beginAtZero: true, grid: { color: 'rgba(0, 0, 0, 0.05)' } },

                                x: { grid: { display: false } }

                            }

                        }

                    });

                }

                

                // Analytics Charts

                this.initializeAnalyticsCharts();

            }



            initializeAnalyticsCharts() {

                const countryCtx = document.getElementById('country-chart');

                if (countryCtx && !this.countryChart) {

                    this.countryChart = new Chart(countryCtx, {

                        type: 'bar',

                        data: { labels: [], datasets: [{ label: 'Visits', data: [] }] },

                        options: {

                            indexAxis: 'y',

                            responsive: true,

                            maintainAspectRatio: false,

                            plugins: { legend: { display: false } },

                            scales: { x: { beginAtZero: true } }

                        }

                    });

                }



                const trafficCtx = document.getElementById('traffic-source-chart');

                if (trafficCtx && !this.trafficSourceChart) {

                    this.trafficSourceChart = new Chart(trafficCtx, {

                        type: 'pie',

                        data: { labels: [], datasets: [{ data: [] }] },

                        options: {

                            responsive: true,

                            maintainAspectRatio: false,

                             plugins: { legend: { position: 'bottom' } },

                        }

                    });

                }

                

                const pageViewsCtx = document.getElementById('page-views-chart');

                if (pageViewsCtx && !this.pageViewsChart) {

                     this.pageViewsChart = new Chart(pageViewsCtx, {

                        type: 'line',

                        data: { labels: [], datasets: [{ label: 'Page Views', data: [] }] },

                        options: {

                            responsive: true,

                            maintainAspectRatio: false,

                            plugins: { legend: { display: false } },

                            scales: { y: { beginAtZero: true } }

                        }

                    });

                }

            }

            

            async loadAnalyticsData() {

                try {

                    const response = await this.fetchWithCSRF('/api/analytics');

                    if (!response.ok) {

                        throw new Error(`Failed to fetch analytics data: ${response.statusText}`);

                    }

                    const data = await response.json();



                    // Update stat cards

                    document.getElementById('realtime-users').textContent = data.realtimeUsers;

                    document.getElementById('total-visits').textContent = data.totalVisits24h;

                    document.getElementById('avg-duration').textContent = data.avgDuration;

                    document.getElementById('bounce-rate').textContent = data.bounceRate;



                    // Update charts

                    if (this.countryChart) {

                        this.countryChart.data.labels = data.countryData.labels;

                        this.countryChart.data.datasets[0].data = data.countryData.data;

                        this.countryChart.data.datasets[0].backgroundColor = '#6366f1';

                        this.countryChart.update();

                    }



                    if (this.trafficSourceChart) {

                        this.trafficSourceChart.data.labels = data.trafficSourceData.labels;

                        this.trafficSourceChart.data.datasets[0].data = data.trafficSourceData.data;

                        this.trafficSourceChart.data.datasets[0].backgroundColor = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b'];

                        this.trafficSourceChart.update();

                    }

                    

                    if(this.pageViewsChart) {

                        this.pageViewsChart.data.labels = data.pageViews7d.labels;

                        this.pageViewsChart.data.datasets[0].data = data.pageViews7d.data;

                        this.pageViewsChart.data.datasets[0].borderColor = '#10b981';

                        this.pageViewsChart.data.datasets[0].backgroundColor = 'rgba(16, 185, 129, 0.1)';

                        this.pageViewsChart.data.datasets[0].fill = true;

                        this.pageViewsChart.data.datasets[0].tension = 0.4;

                        this.pageViewsChart.update();

                    }



                } catch (error) {

                    console.error('Error loading analytics data:', error);

                    this.showNotification('Could not load analytics data from the server.', 'error');

                }

            }





            setupKeyboardShortcuts() {

                document.addEventListener('keydown', (e) => {

                    if (e.ctrlKey || e.metaKey) {

                        switch(e.key) {

                            case 'r': 

                                e.preventDefault(); 

                                this.refreshData(false); 

                                break;

                            case 'k': 

                                e.preventDefault(); 

                                const searchInput = document.getElementById('search-input');

                                if (searchInput) searchInput.focus(); 

                                break;

                            case 'e':

                                e.preventDefault();

                                this.exportCSV();

                                break;

                            case 'b':

                                e.preventDefault();

                                this.createBackup();

                                break;

                            case '/':

                                e.preventDefault();

                                this.showShortcutsHelp();

                                break;

                        }

                        

                        if (e.key >= '1' && e.key <= '9') {

                            e.preventDefault();

                            const tabs = ['dashboard', 'submissions', 'chats', 'team', 'crm', 'analytics', 'inventory', 'qa', 'settings'];

                            const index = parseInt(e.key) - 1;

                            if (tabs[index]) this.switchTab(tabs[index]);

                        }

                    }

                    

                    if (e.key === 'Escape') {

                        document.getElementById('chat-ticket-modal').style.display = 'none';

                        document.getElementById('detailView').style.display = 'none';

                        this.closeMobileMenu();

                    }

                });

            }



            showShortcutsHelp() {

                const shortcuts = `

                    <div style="padding: 20px;">

                        <h3 style="margin-bottom: 16px;">Keyboard Shortcuts</h3>

                        <table style="width: 100%; border-collapse: collapse;">

                            <tr><td><kbd>Ctrl+K</kbd></td><td>Focus Search</td></tr>

                            <tr><td><kbd>Ctrl+R</kbd></td><td>Refresh Data</td></tr>

                            <tr><td><kbd>Ctrl+E</kbd></td><td>Export CSV</td></tr>

                            <tr><td><kbd>Ctrl+B</kbd></td><td>Create Backup</td></tr>

                            <tr><td><kbd>Ctrl+1-9</kbd></td><td>Switch Tabs</td></tr>

                            <tr><td><kbd>Esc</kbd></td><td>Close Modals</td></tr>

                        </table>

                    </div>

                `;

                this.showNotification(shortcuts, 'info', 6000);

            }

        }



        document.addEventListener('DOMContentLoaded', function() {

            window.adminPanel = new ModernAdminPanel();

        });

    </script>

</body>

</html>



